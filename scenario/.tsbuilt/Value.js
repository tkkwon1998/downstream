"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ArrayV = exports.ListV = exports.PreciseV = exports.PercentV = exports.ExpNumberV = exports.NumberV = exports.AddressV = exports.MapV = exports.StringV = exports.BoolV = exports.NothingV = exports.AnythingV = exports.EventV = exports.Order = void 0;
const bignumber_js_1 = __importDefault(require("bignumber.js"));
const Encoding_1 = require("./Encoding");
const Formatter_1 = require("./Formatter");
bignumber_js_1.default.config({ ROUNDING_MODE: 3 });
const mantissaOne = new bignumber_js_1.default('1.0e18');
var Order;
(function (Order) {
    Order[Order["EQUAL"] = 0] = "EQUAL";
    Order[Order["LESS_THAN"] = 1] = "LESS_THAN";
    Order[Order["GREATER_THAN"] = 2] = "GREATER_THAN";
})(Order = exports.Order || (exports.Order = {}));
function compareInt(a, b) {
    if (a === b) {
        return Order.EQUAL;
    }
    else if (a > b) {
        return Order.GREATER_THAN;
    }
    else {
        return Order.LESS_THAN;
    }
}
class EventV {
    constructor(val) {
        this.val = val;
    }
    compareTo(world, given) {
        if (given instanceof EventV) {
            return JSON.stringify(this.val) === JSON.stringify(given.val);
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `EventV<val=${Formatter_1.formatEvent(this.val)}>`;
    }
    truthy() {
        // This check applies to strings or arrays :)
        return this.val.length > 0;
    }
}
exports.EventV = EventV;
class AnythingV {
    compareTo(world, given) {
        // Everything is awesome.
        return true;
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `AnythingV<>`;
    }
    truthy() {
        return true;
    }
}
exports.AnythingV = AnythingV;
class NothingV {
    constructor() {
        this.val = null;
    }
    compareTo(world, given) {
        // Everything is not awesome.
        return false;
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    encode() {
        return null;
    }
    toString() {
        return `NothingV<>`;
    }
    truthy() {
        return false;
    }
}
exports.NothingV = NothingV;
class BoolV {
    constructor(val) {
        this.val = val;
    }
    compareTo(world, given) {
        if (given instanceof BoolV) {
            return this.val === given.val;
        }
        else if (given instanceof NumberV) {
            return this.compareTo(world, given.toBoolV());
        }
        else if (given instanceof StringV && (given.val === 'true' || given.val === 'false')) {
            return this.val || given.val !== 'true';
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `BoolV<val=${this.val}>`;
    }
    truthy() {
        return this.val;
    }
}
exports.BoolV = BoolV;
class StringV {
    constructor(val) {
        this.val = val;
    }
    compareTo(world, given) {
        if (given instanceof StringV) {
            return this.val === given.val;
        }
        else if (given instanceof AddressV) {
            return world.web3.utils.toChecksumAddress(this.val) === world.web3.utils.toChecksumAddress(given.val);
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `StringV<val=${this.val}>`;
    }
    truthy() {
        return this.val.length > 0;
    }
}
exports.StringV = StringV;
class MapV {
    constructor(val) {
        this.val = val;
    }
    compareTo(world, given) {
        if (given instanceof MapV) {
            return JSON.stringify(this.val) === JSON.stringify(given.val);
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `MapV<val=${JSON.stringify(this.val)}>`;
    }
    truthy() {
        return Object.keys(this.val).length > 0;
    }
}
exports.MapV = MapV;
class AddressV {
    constructor(val) {
        this.val = val;
    }
    compareTo(world, given) {
        if (given instanceof AddressV || given instanceof StringV) {
            return world.web3.utils.toChecksumAddress(this.val) === world.web3.utils.toChecksumAddress(given.val);
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `AddressV<val=${this.val}>`;
    }
    truthy() {
        return this.val !== "0x0000000000000000000000000000000000000000";
    }
}
exports.AddressV = AddressV;
class NumberV {
    constructor(val, denom) {
        if (denom) {
            this.val = Number(val) / denom;
        }
        else {
            this.val = val;
        }
    }
    toNumber() {
        return Number(this.val);
    }
    encode() {
        return Encoding_1.toEncodableNum(this.val);
    }
    compareTo(world, given) {
        if (given instanceof NumberV) {
            const thisBig = new bignumber_js_1.default(this.val).toFixed();
            const givenBig = new bignumber_js_1.default(given.val).toFixed();
            return thisBig === givenBig;
        }
        else if (given instanceof PreciseV) {
            return this.compareTo(world, given.toNumberV());
        }
        else if (given instanceof StringV) {
            return this.compareTo(world, new NumberV(Number(given.val)));
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        if (given instanceof NumberV) {
            const thisBig = new bignumber_js_1.default(this.val).toNumber();
            const givenBig = new bignumber_js_1.default(given.val).toNumber();
            return compareInt(thisBig, givenBig);
        }
        else if (given instanceof PreciseV) {
            return this.compareOrder(world, given.toNumberV());
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    toBoolV() {
        if (this.val === 0) {
            return new BoolV(true);
        }
        else if (this.val === 1) {
            return new BoolV(false);
        }
        throw new Error(`Cannot convert number ${this.val} into bool`);
    }
    asExp(denom = undefined) {
        return new bignumber_js_1.default(this.val).toExponential();
    }
    show() {
        return new bignumber_js_1.default(this.val).toExponential();
    }
    toString() {
        return `NumberV<val=${this.val},exp=${this.asExp()}>`;
    }
    truthy() {
        return this.val != 0;
    }
    add(b) {
        return new NumberV(new bignumber_js_1.default(this.val).plus(new bignumber_js_1.default(b.val)).toFixed());
    }
    div(b) {
        return new NumberV(new bignumber_js_1.default(this.val).div(new bignumber_js_1.default(b.val)).toFixed());
    }
    mul(b) {
        return new NumberV(new bignumber_js_1.default(this.val).times(new bignumber_js_1.default(b.val)).toFixed());
    }
    sub(b) {
        return new NumberV(new bignumber_js_1.default(this.val).minus(new bignumber_js_1.default(b.val)).toFixed());
    }
}
exports.NumberV = NumberV;
class ExpNumberV extends NumberV {
    show() {
        return new bignumber_js_1.default(this.val).dividedBy(mantissaOne).toNumber().toString();
    }
}
exports.ExpNumberV = ExpNumberV;
class PercentV extends NumberV {
    show() {
        return new bignumber_js_1.default(this.val).dividedBy(mantissaOne).multipliedBy(new bignumber_js_1.default(100)).toNumber().toString() + '%';
    }
}
exports.PercentV = PercentV;
class PreciseV {
    constructor(val, precision) {
        this.val = val;
        this.precision = precision;
    }
    compareTo(world, given) {
        if (given instanceof NumberV) {
            const thisBig = new bignumber_js_1.default(this.val.toString()).toPrecision(this.precision);
            const givenBig = new bignumber_js_1.default(given.val.toString()).toPrecision(this.precision);
            return thisBig === givenBig;
        }
        else if (given instanceof PreciseV) {
            // TODO: Is this okay?
            return this.compareTo(world, given.toNumberV());
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toNumberV() {
        return new NumberV(this.val);
    }
    toString() {
        return `PreciseV<val=${this.val}, precision=${this.precision}>`;
    }
    truthy() {
        return this.val != 0;
    }
}
exports.PreciseV = PreciseV;
class ListV {
    constructor(els) {
        this.val = els;
    }
    compareTo(world, given) {
        if (given instanceof ListV || given instanceof ArrayV) {
            return this.val.every((el, i) => el.compareTo(world, given.val[i] || new NothingV()));
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `ListV<val=${this.val.map(el => el.toString()).join(',')}>`;
    }
    truthy() {
        return this.val.length > 0;
    }
}
exports.ListV = ListV;
class ArrayV {
    constructor(els) {
        this.val = els;
    }
    compareTo(world, given) {
        if (given instanceof ListV || given instanceof ArrayV) {
            return this.val.every((el, i) => el.compareTo(world, given.val[i] || new NothingV()));
        }
        else {
            throw new Error(`Cannot compare ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
        }
    }
    compareOrder(world, given) {
        throw new Error(`Cannot compare order of ${typeof this} to ${typeof given} (${this.toString()}, ${given.toString()})`);
    }
    toString() {
        return `ArrayV<val=${this.val.map(el => el.toString()).join(',')}>`;
    }
    truthy() {
        return this.val.length > 0;
    }
}
exports.ArrayV = ArrayV;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmFsdWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvVmFsdWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBRUEsZ0VBQXFDO0FBQ3JDLHlDQUEwQztBQUMxQywyQ0FBd0M7QUFFeEMsc0JBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxhQUFhLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUN2QyxNQUFNLFdBQVcsR0FBRyxJQUFJLHNCQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFNUMsSUFBWSxLQUlYO0FBSkQsV0FBWSxLQUFLO0lBQ2YsbUNBQUssQ0FBQTtJQUNMLDJDQUFTLENBQUE7SUFDVCxpREFBWSxDQUFBO0FBQ2QsQ0FBQyxFQUpXLEtBQUssR0FBTCxhQUFLLEtBQUwsYUFBSyxRQUloQjtBQVNELFNBQVMsVUFBVSxDQUFDLENBQVMsRUFBRSxDQUFTO0lBQ3RDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNYLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQztLQUNwQjtTQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUNoQixPQUFPLEtBQUssQ0FBQyxZQUFZLENBQUM7S0FDM0I7U0FBTTtRQUNMLE9BQU8sS0FBSyxDQUFDLFNBQVMsQ0FBQztLQUN4QjtBQUNILENBQUM7QUFFRCxNQUFhLE1BQU07SUFHakIsWUFBWSxHQUFHO1FBQ2IsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDakIsQ0FBQztJQUVELFNBQVMsQ0FBQyxLQUFZLEVBQUUsS0FBWTtRQUNsQyxJQUFJLEtBQUssWUFBWSxNQUFNLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUMvRDthQUFNO1lBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQkFBa0IsT0FBTyxJQUFJLE9BQU8s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RUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3ZGO2FBQU07WUFDTCxNQUFNLElBQUksS0FBSyxDQUFDLGtCQUFrQixPQUFPLElBQUksT0FBTyxPQUFPLEtBQUssS0FBSyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssS0FBSyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUMvRztJQUNILENBQUM7SUFFRCxZQUFZLENBQUMsS0FBWSxFQUFFLEtBQVk7UUFDckMsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsT0FBTyxJQUFJLE9BQU8sT0FBTyxLQUFLLEtBQUssSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLEtBQUssQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDekgsQ0FBQztJQUVELFFBQVE7UUFDTixPQUFPLGNBQWMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztJQUN0RSxDQUFDO0lBRUQsTUFBTTtRQUNKLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLENBQUM7Q0FDRjtBQTFCRCx3QkEwQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1dvcmxkfSBmcm9tICcuL1dvcmxkJztcbmltcG9ydCB7RXZlbnR9IGZyb20gJy4vRXZlbnQnO1xuaW1wb3J0IEJpZ051bWJlciBmcm9tICdiaWdudW1iZXIuanMnO1xuaW1wb3J0IHt0b0VuY29kYWJsZU51bX0gZnJvbSAnLi9FbmNvZGluZyc7XG5pbXBvcnQge2Zvcm1hdEV2ZW50fSBmcm9tICcuL0Zvcm1hdHRlcic7XG5cbkJpZ051bWJlci5jb25maWcoeyBST1VORElOR19NT0RFOiAzIH0pO1xuY29uc3QgbWFudGlzc2FPbmUgPSBuZXcgQmlnTnVtYmVyKCcxLjBlMTgnKTtcblxuZXhwb3J0IGVudW0gT3JkZXIge1xuICBFUVVBTCxcbiAgTEVTU19USEFOLFxuICBHUkVBVEVSX1RIQU5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBWYWx1ZSB7XG4gIGNvbXBhcmVUbyh3b3JsZDogV29ybGQsIGdpdmVuOiBWYWx1ZSk6IGJvb2xlYW5cbiAgY29tcGFyZU9yZGVyKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogT3JkZXJcbiAgdG9TdHJpbmcoKTogc3RyaW5nXG4gIHRydXRoeSgpOiBib29sZWFuXG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVJbnQoYTogbnVtYmVyLCBiOiBudW1iZXIpOiBPcmRlciB7XG4gIGlmIChhID09PSBiKSB7XG4gICAgcmV0dXJuIE9yZGVyLkVRVUFMO1xuICB9IGVsc2UgaWYgKGEgPiBiKSB7XG4gICAgcmV0dXJuIE9yZGVyLkdSRUFURVJfVEhBTjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gT3JkZXIuTEVTU19USEFOO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBFdmVudFYgaW1wbGVtZW50cyBWYWx1ZSB7XG4gIHZhbDogRXZlbnRcblxuICBjb25zdHJ1Y3Rvcih2YWwpIHtcbiAgICB0aGlzLnZhbCA9IHZhbDtcbiAgfVxuXG4gIGNvbXBhcmVUbyh3b3JsZDogV29ybGQsIGdpdmVuOiBWYWx1ZSk6IGJvb2xlYW4ge1xuICAgIGlmIChnaXZlbiBpbnN0YW5jZW9mIEV2ZW50Vikge1xuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudmFsKSA9PT0gSlNPTi5zdHJpbmdpZnkoZ2l2ZW4udmFsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY29tcGFyZSAke3R5cGVvZiB0aGlzfSB0byAke3R5cGVvZiBnaXZlbn0gKCR7dGhpcy50b1N0cmluZygpfSwgJHtnaXZlbi50b1N0cmluZygpfSlgKTtcbiAgICB9XG4gIH1cblxuICBjb21wYXJlT3JkZXIod29ybGQ6IFdvcmxkLCBnaXZlbjogVmFsdWUpOiBPcmRlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY29tcGFyZSBvcmRlciBvZiAke3R5cGVvZiB0aGlzfSB0byAke3R5cGVvZiBnaXZlbn0gKCR7dGhpcy50b1N0cmluZygpfSwgJHtnaXZlbi50b1N0cmluZygpfSlgKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgRXZlbnRWPHZhbD0ke2Zvcm1hdEV2ZW50KHRoaXMudmFsKX0+YDtcbiAgfVxuXG4gIHRydXRoeSgpIHtcbiAgICAvLyBUaGlzIGNoZWNrIGFwcGxpZXMgdG8gc3RyaW5ncyBvciBhcnJheXMgOilcbiAgICByZXR1cm4gdGhpcy52YWwubGVuZ3RoID4gMDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQW55dGhpbmdWIGltcGxlbWVudHMgVmFsdWUge1xuICBjb21wYXJlVG8od29ybGQ6IFdvcmxkLCBnaXZlbjogVmFsdWUpOiBib29sZWFuIHtcbiAgICAvLyBFdmVyeXRoaW5nIGlzIGF3ZXNvbWUuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb21wYXJlT3JkZXIod29ybGQ6IFdvcmxkLCBnaXZlbjogVmFsdWUpOiBPcmRlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY29tcGFyZSBvcmRlciBvZiAke3R5cGVvZiB0aGlzfSB0byAke3R5cGVvZiBnaXZlbn0gKCR7dGhpcy50b1N0cmluZygpfSwgJHtnaXZlbi50b1N0cmluZygpfSlgKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgQW55dGhpbmdWPD5gO1xuICB9XG5cbiAgdHJ1dGh5KCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOb3RoaW5nViBpbXBsZW1lbnRzIFZhbHVlIHtcbiAgdmFsOiBudWxsXG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy52YWwgPSBudWxsO1xuICB9XG5cbiAgY29tcGFyZVRvKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogYm9vbGVhbiB7XG4gICAgLy8gRXZlcnl0aGluZyBpcyBub3QgYXdlc29tZS5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb21wYXJlT3JkZXIod29ybGQ6IFdvcmxkLCBnaXZlbjogVmFsdWUpOiBPcmRlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY29tcGFyZSBvcmRlciBvZiAke3R5cGVvZiB0aGlzfSB0byAke3R5cGVvZiBnaXZlbn0gKCR7dGhpcy50b1N0cmluZygpfSwgJHtnaXZlbi50b1N0cmluZygpfSlgKTtcbiAgfVxuXG4gIGVuY29kZSgpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgTm90aGluZ1Y8PmA7XG4gIH1cblxuICB0cnV0aHkoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBCb29sViBpbXBsZW1lbnRzIFZhbHVlIHtcbiAgdmFsOiBib29sZWFuXG5cbiAgY29uc3RydWN0b3IodmFsKSB7XG4gICAgdGhpcy52YWwgPSB2YWw7XG4gIH1cblxuICBjb21wYXJlVG8od29ybGQ6IFdvcmxkLCBnaXZlbjogVmFsdWUpOiBib29sZWFuIHtcbiAgICBpZiAoZ2l2ZW4gaW5zdGFuY2VvZiBCb29sVikge1xuICAgICAgcmV0dXJuIHRoaXMudmFsID09PSBnaXZlbi52YWw7XG4gICAgfSBlbHNlIGlmIChnaXZlbiBpbnN0YW5jZW9mIE51bWJlclYpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVUbyh3b3JsZCwgZ2l2ZW4udG9Cb29sVigpKTtcbiAgICB9IGVsc2UgaWYgKGdpdmVuIGluc3RhbmNlb2YgU3RyaW5nViAmJiAoIGdpdmVuLnZhbCA9PT0gJ3RydWUnIHx8IGdpdmVuLnZhbCA9PT0gJ2ZhbHNlJyApKSB7XG4gICAgICByZXR1cm4gdGhpcy52YWwgfHwgZ2l2ZW4udmFsICE9PSAndHJ1ZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gICAgfVxuICB9XG5cbiAgY29tcGFyZU9yZGVyKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogT3JkZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgb3JkZXIgb2YgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gYEJvb2xWPHZhbD0ke3RoaXMudmFsfT5gO1xuICB9XG5cbiAgdHJ1dGh5KCkge1xuICAgIHJldHVybiB0aGlzLnZhbDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3RyaW5nViBpbXBsZW1lbnRzIFZhbHVlIHtcbiAgdmFsOiBzdHJpbmdcblxuICBjb25zdHJ1Y3Rvcih2YWwpIHtcbiAgICB0aGlzLnZhbCA9IHZhbDtcbiAgfVxuXG4gIGNvbXBhcmVUbyh3b3JsZDogV29ybGQsIGdpdmVuOiBWYWx1ZSk6IGJvb2xlYW4ge1xuICAgIGlmIChnaXZlbiBpbnN0YW5jZW9mIFN0cmluZ1YpIHtcbiAgICAgIHJldHVybiB0aGlzLnZhbCA9PT0gZ2l2ZW4udmFsO1xuICAgIH0gZWxzZSBpZiAoIGdpdmVuIGluc3RhbmNlb2YgQWRkcmVzc1YpIHtcbiAgICAgIHJldHVybiB3b3JsZC53ZWIzLnV0aWxzLnRvQ2hlY2tzdW1BZGRyZXNzKHRoaXMudmFsKSA9PT0gd29ybGQud2ViMy51dGlscy50b0NoZWNrc3VtQWRkcmVzcyhnaXZlbi52YWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjb21wYXJlICR7dHlwZW9mIHRoaXN9IHRvICR7dHlwZW9mIGdpdmVufSAoJHt0aGlzLnRvU3RyaW5nKCl9LCAke2dpdmVuLnRvU3RyaW5nKCl9KWApO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBhcmVPcmRlcih3b3JsZDogV29ybGQsIGdpdmVuOiBWYWx1ZSk6IE9yZGVyIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjb21wYXJlIG9yZGVyIG9mICR7dHlwZW9mIHRoaXN9IHRvICR7dHlwZW9mIGdpdmVufSAoJHt0aGlzLnRvU3RyaW5nKCl9LCAke2dpdmVuLnRvU3RyaW5nKCl9KWApO1xuICB9XG5cbiAgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIGBTdHJpbmdWPHZhbD0ke3RoaXMudmFsfT5gO1xuICB9XG5cbiAgdHJ1dGh5KCkge1xuICAgIHJldHVybiB0aGlzLnZhbC5sZW5ndGggPiAwO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBNYXBWIGltcGxlbWVudHMgVmFsdWUge1xuICB2YWw6IG9iamVjdFxuXG4gIGNvbnN0cnVjdG9yKHZhbCkge1xuICAgIHRoaXMudmFsID0gdmFsO1xuICB9XG5cbiAgY29tcGFyZVRvKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogYm9vbGVhbiB7XG4gICAgaWYgKGdpdmVuIGluc3RhbmNlb2YgTWFwVikge1xuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudmFsKSA9PT0gSlNPTi5zdHJpbmdpZnkoZ2l2ZW4udmFsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY29tcGFyZSAke3R5cGVvZiB0aGlzfSB0byAke3R5cGVvZiBnaXZlbn0gKCR7dGhpcy50b1N0cmluZygpfSwgJHtnaXZlbi50b1N0cmluZygpfSlgKTtcbiAgICB9XG4gIH1cblxuICBjb21wYXJlT3JkZXIod29ybGQ6IFdvcmxkLCBnaXZlbjogVmFsdWUpOiBPcmRlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY29tcGFyZSBvcmRlciBvZiAke3R5cGVvZiB0aGlzfSB0byAke3R5cGVvZiBnaXZlbn0gKCR7dGhpcy50b1N0cmluZygpfSwgJHtnaXZlbi50b1N0cmluZygpfSlgKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgTWFwVjx2YWw9JHtKU09OLnN0cmluZ2lmeSh0aGlzLnZhbCl9PmA7XG4gIH1cblxuICB0cnV0aHkoKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMudmFsKS5sZW5ndGggPiAwO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBZGRyZXNzViBpbXBsZW1lbnRzIFZhbHVlIHtcbiAgdmFsOiBzdHJpbmdcblxuICBjb25zdHJ1Y3Rvcih2YWwpIHtcbiAgICB0aGlzLnZhbCA9IHZhbDtcbiAgfVxuXG4gIGNvbXBhcmVUbyh3b3JsZDogV29ybGQsIGdpdmVuOiBWYWx1ZSk6IGJvb2xlYW4ge1xuICAgIGlmIChnaXZlbiBpbnN0YW5jZW9mIEFkZHJlc3NWIHx8IGdpdmVuIGluc3RhbmNlb2YgU3RyaW5nVikge1xuICAgICAgcmV0dXJuIHdvcmxkLndlYjMudXRpbHMudG9DaGVja3N1bUFkZHJlc3ModGhpcy52YWwpID09PSB3b3JsZC53ZWIzLnV0aWxzLnRvQ2hlY2tzdW1BZGRyZXNzKGdpdmVuLnZhbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gICAgfVxuICB9XG5cbiAgY29tcGFyZU9yZGVyKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogT3JkZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgb3JkZXIgb2YgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gYEFkZHJlc3NWPHZhbD0ke3RoaXMudmFsfT5gO1xuICB9XG5cbiAgdHJ1dGh5KCkge1xuICAgIHJldHVybiB0aGlzLnZhbCAhPT0gXCIweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDBcIjtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTnVtYmVyViBpbXBsZW1lbnRzIFZhbHVlIHtcbiAgdmFsIDogbnVtYmVyIHwgc3RyaW5nXG5cbiAgY29uc3RydWN0b3IodmFsOiBudW1iZXIgfCBzdHJpbmcsIGRlbm9tPzogbnVtYmVyIHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKGRlbm9tKSB7XG4gICAgICB0aGlzLnZhbCA9IE51bWJlcih2YWwpIC8gZGVub207XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmFsID0gdmFsO1xuICAgIH1cbiAgfVxuXG4gIHRvTnVtYmVyKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIE51bWJlcih0aGlzLnZhbCk7XG4gIH1cblxuICBlbmNvZGUoKSB7XG4gICAgcmV0dXJuIHRvRW5jb2RhYmxlTnVtKHRoaXMudmFsKTtcbiAgfVxuXG4gIGNvbXBhcmVUbyh3b3JsZDogV29ybGQsIGdpdmVuOiBWYWx1ZSk6IGJvb2xlYW4ge1xuICAgIGlmIChnaXZlbiBpbnN0YW5jZW9mIE51bWJlclYpIHtcbiAgICAgIGNvbnN0IHRoaXNCaWcgPSBuZXcgQmlnTnVtYmVyKHRoaXMudmFsKS50b0ZpeGVkKCk7XG4gICAgICBjb25zdCBnaXZlbkJpZyA9IG5ldyBCaWdOdW1iZXIoZ2l2ZW4udmFsKS50b0ZpeGVkKCk7XG5cbiAgICAgIHJldHVybiB0aGlzQmlnID09PSBnaXZlbkJpZztcbiAgICB9IGVsc2UgaWYgKGdpdmVuIGluc3RhbmNlb2YgUHJlY2lzZVYpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVUbyh3b3JsZCwgZ2l2ZW4udG9OdW1iZXJWKCkpO1xuICAgIH0gZWxzZSBpZiAoZ2l2ZW4gaW5zdGFuY2VvZiBTdHJpbmdWKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21wYXJlVG8od29ybGQsIG5ldyBOdW1iZXJWKE51bWJlcihnaXZlbi52YWwpKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gICAgfVxuICB9XG5cbiAgY29tcGFyZU9yZGVyKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogT3JkZXIge1xuICAgIGlmIChnaXZlbiBpbnN0YW5jZW9mIE51bWJlclYpIHtcbiAgICAgIGNvbnN0IHRoaXNCaWcgPSBuZXcgQmlnTnVtYmVyKHRoaXMudmFsKS50b051bWJlcigpO1xuICAgICAgY29uc3QgZ2l2ZW5CaWcgPSBuZXcgQmlnTnVtYmVyKGdpdmVuLnZhbCkudG9OdW1iZXIoKTtcblxuICAgICAgcmV0dXJuIGNvbXBhcmVJbnQodGhpc0JpZywgZ2l2ZW5CaWcpO1xuICAgIH0gZWxzZSBpZiAoZ2l2ZW4gaW5zdGFuY2VvZiBQcmVjaXNlVikge1xuICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZU9yZGVyKHdvcmxkLCBnaXZlbi50b051bWJlclYoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gICAgfVxuICB9XG5cbiAgdG9Cb29sVigpOiBCb29sViB7XG4gICAgaWYgKHRoaXMudmFsID09PSAwKSB7XG4gICAgICByZXR1cm4gbmV3IEJvb2xWKHRydWUpXG4gICAgfSBlbHNlIGlmICh0aGlzLnZhbCA9PT0gMSkge1xuICAgICAgcmV0dXJuIG5ldyBCb29sVihmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY29udmVydCBudW1iZXIgJHt0aGlzLnZhbH0gaW50byBib29sYClcbiAgfVxuXG4gIGFzRXhwKGRlbm9tPXVuZGVmaW5lZCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIG5ldyBCaWdOdW1iZXIodGhpcy52YWwpLnRvRXhwb25lbnRpYWwoKTtcbiAgfVxuXG4gIHNob3coKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbmV3IEJpZ051bWJlcih0aGlzLnZhbCkudG9FeHBvbmVudGlhbCgpO1xuICB9XG5cbiAgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIGBOdW1iZXJWPHZhbD0ke3RoaXMudmFsfSxleHA9JHt0aGlzLmFzRXhwKCl9PmA7XG4gIH1cblxuICB0cnV0aHkoKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsICE9IDA7XG4gIH1cblxuICBhZGQoYjogTnVtYmVyVik6IE51bWJlclYge1xuICAgIHJldHVybiBuZXcgTnVtYmVyVihuZXcgQmlnTnVtYmVyKHRoaXMudmFsKS5wbHVzKG5ldyBCaWdOdW1iZXIoYi52YWwpKS50b0ZpeGVkKCkpO1xuICB9XG5cbiAgZGl2KGI6IE51bWJlclYpOiBOdW1iZXJWIHtcbiAgICByZXR1cm4gbmV3IE51bWJlclYobmV3IEJpZ051bWJlcih0aGlzLnZhbCkuZGl2KG5ldyBCaWdOdW1iZXIoYi52YWwpKS50b0ZpeGVkKCkpO1xuICB9XG5cbiAgbXVsKGI6IE51bWJlclYpOiBOdW1iZXJWIHtcbiAgICByZXR1cm4gbmV3IE51bWJlclYobmV3IEJpZ051bWJlcih0aGlzLnZhbCkudGltZXMobmV3IEJpZ051bWJlcihiLnZhbCkpLnRvRml4ZWQoKSk7XG4gIH1cblxuICBzdWIoYjogTnVtYmVyVik6IE51bWJlclYge1xuICAgIHJldHVybiBuZXcgTnVtYmVyVihuZXcgQmlnTnVtYmVyKHRoaXMudmFsKS5taW51cyhuZXcgQmlnTnVtYmVyKGIudmFsKSkudG9GaXhlZCgpKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRXhwTnVtYmVyViBleHRlbmRzIE51bWJlclYge1xuICBzaG93KCkge1xuICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKHRoaXMudmFsKS5kaXZpZGVkQnkobWFudGlzc2FPbmUpLnRvTnVtYmVyKCkudG9TdHJpbmcoKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGVyY2VudFYgZXh0ZW5kcyBOdW1iZXJWIHtcbiAgc2hvdygpIHtcbiAgICByZXR1cm4gbmV3IEJpZ051bWJlcih0aGlzLnZhbCkuZGl2aWRlZEJ5KG1hbnRpc3NhT25lKS5tdWx0aXBsaWVkQnkobmV3IEJpZ051bWJlcigxMDApKS50b051bWJlcigpLnRvU3RyaW5nKCkgKyAnJSc7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByZWNpc2VWIGltcGxlbWVudHMgVmFsdWUge1xuICB2YWw6IG51bWJlclxuICBwcmVjaXNpb246IG51bWJlclxuXG4gIGNvbnN0cnVjdG9yKHZhbCwgcHJlY2lzaW9uKSB7XG4gICAgdGhpcy52YWwgPSB2YWw7XG4gICAgdGhpcy5wcmVjaXNpb24gPSBwcmVjaXNpb247XG4gIH1cblxuICBjb21wYXJlVG8od29ybGQ6IFdvcmxkLCBnaXZlbjogVmFsdWUpOiBib29sZWFuIHtcbiAgICBpZiAoZ2l2ZW4gaW5zdGFuY2VvZiBOdW1iZXJWKSB7XG4gICAgICBjb25zdCB0aGlzQmlnID0gbmV3IEJpZ051bWJlcih0aGlzLnZhbC50b1N0cmluZygpKS50b1ByZWNpc2lvbih0aGlzLnByZWNpc2lvbik7XG4gICAgICBjb25zdCBnaXZlbkJpZyA9IG5ldyBCaWdOdW1iZXIoZ2l2ZW4udmFsLnRvU3RyaW5nKCkpLnRvUHJlY2lzaW9uKHRoaXMucHJlY2lzaW9uKTtcblxuICAgICAgcmV0dXJuIHRoaXNCaWcgPT09IGdpdmVuQmlnO1xuICAgIH0gZWxzZSBpZiAoZ2l2ZW4gaW5zdGFuY2VvZiBQcmVjaXNlVikge1xuICAgICAgLy8gVE9ETzogSXMgdGhpcyBva2F5P1xuICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZVRvKHdvcmxkLCBnaXZlbi50b051bWJlclYoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gICAgfVxuICB9XG5cbiAgY29tcGFyZU9yZGVyKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogT3JkZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgb3JkZXIgb2YgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gIH1cblxuICB0b051bWJlclYoKTogTnVtYmVyViB7XG4gICAgcmV0dXJuIG5ldyBOdW1iZXJWKHRoaXMudmFsKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiBgUHJlY2lzZVY8dmFsPSR7dGhpcy52YWx9LCBwcmVjaXNpb249JHt0aGlzLnByZWNpc2lvbn0+YDtcbiAgfVxuXG4gIHRydXRoeSgpIHtcbiAgICByZXR1cm4gdGhpcy52YWwgIT0gMDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTGlzdFYgaW1wbGVtZW50cyBWYWx1ZSB7XG4gIHZhbDogVmFsdWVbXVxuXG4gIGNvbnN0cnVjdG9yKGVscykge1xuICAgIHRoaXMudmFsID0gZWxzO1xuICB9XG5cbiAgY29tcGFyZVRvKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogYm9vbGVhbiB7XG4gICAgaWYgKGdpdmVuIGluc3RhbmNlb2YgTGlzdFYgfHwgZ2l2ZW4gaW5zdGFuY2VvZiBBcnJheVYpIHtcbiAgICAgIHJldHVybiB0aGlzLnZhbC5ldmVyeSgoZWwsIGkpID0+IGVsLmNvbXBhcmVUbyh3b3JsZCwgZ2l2ZW4udmFsW2ldIHx8IG5ldyBOb3RoaW5nVigpKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gICAgfVxuICB9XG5cbiAgY29tcGFyZU9yZGVyKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogT3JkZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgb3JkZXIgb2YgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gYExpc3RWPHZhbD0ke3RoaXMudmFsLm1hcChlbCA9PiBlbC50b1N0cmluZygpKS5qb2luKCcsJyl9PmA7XG4gIH1cblxuICB0cnV0aHkoKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsLmxlbmd0aCA+IDA7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFycmF5VjxUIGV4dGVuZHMgVmFsdWU+IGltcGxlbWVudHMgVmFsdWUge1xuICB2YWw6IFRbXVxuXG4gIGNvbnN0cnVjdG9yKGVscykge1xuICAgIHRoaXMudmFsID0gZWxzO1xuICB9XG5cbiAgY29tcGFyZVRvKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogYm9vbGVhbiB7XG4gICAgaWYgKGdpdmVuIGluc3RhbmNlb2YgTGlzdFYgfHwgZ2l2ZW4gaW5zdGFuY2VvZiBBcnJheVYpIHtcbiAgICAgIHJldHVybiB0aGlzLnZhbC5ldmVyeSgoZWwsIGkpID0+IGVsLmNvbXBhcmVUbyh3b3JsZCwgZ2l2ZW4udmFsW2ldIHx8IG5ldyBOb3RoaW5nVigpKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gICAgfVxuICB9XG5cbiAgY29tcGFyZU9yZGVyKHdvcmxkOiBXb3JsZCwgZ2l2ZW46IFZhbHVlKTogT3JkZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbXBhcmUgb3JkZXIgb2YgJHt0eXBlb2YgdGhpc30gdG8gJHt0eXBlb2YgZ2l2ZW59ICgke3RoaXMudG9TdHJpbmcoKX0sICR7Z2l2ZW4udG9TdHJpbmcoKX0pYCk7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gYEFycmF5Vjx2YWw9JHt0aGlzLnZhbC5tYXAoZWwgPT4gZWwudG9TdHJpbmcoKSkuam9pbignLCcpfT5gO1xuICB9XG5cbiAgdHJ1dGh5KCkge1xuICAgIHJldHVybiB0aGlzLnZhbC5sZW5ndGggPiAwO1xuICB9XG59XG4iXX0=
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.processErc20Event = exports.erc20Commands = void 0;
const World_1 = require("../World");
const Invokation_1 = require("../Invokation");
const Erc20Builder_1 = require("../Builder/Erc20Builder");
const CoreValue_1 = require("../CoreValue");
const Value_1 = require("../Value");
const Erc20Value_1 = require("../Value/Erc20Value");
const Verify_1 = require("../Verify");
const Command_1 = require("../Command");
const ErrorReporter_1 = require("../ErrorReporter");
const ContractLookup_1 = require("../ContractLookup");
async function genToken(world, from, params) {
    let { world: newWorld, erc20, tokenData } = await Erc20Builder_1.buildErc20(world, from, params);
    world = newWorld;
    world = World_1.addAction(world, `Added ERC-20 token ${tokenData.symbol} (${tokenData.description}) at address ${erc20._address}`, tokenData.invokation);
    return world;
}
async function verifyErc20(world, erc20, name, contract, apiKey) {
    if (world.isLocalNetwork()) {
        world.printer.printLine(`Politely declining to verify on local network: ${world.network}.`);
    }
    else {
        await Verify_1.verify(world, apiKey, name, contract, erc20._address);
    }
    return world;
}
async function approve(world, from, erc20, address, amount) {
    let invokation = await Invokation_1.invoke(world, erc20.methods.approve(address, amount.encode()), from, ErrorReporter_1.CTokenErrorReporter);
    world = World_1.addAction(world, `Approved ${erc20.name} ERC-20 token for ${from} of ${amount.show()}`, invokation);
    return world;
}
async function faucet(world, from, erc20, address, amount) {
    let invokation = await Invokation_1.invoke(world, erc20.methods.allocateTo(address, amount.encode()), from, ErrorReporter_1.CTokenErrorReporter);
    world = World_1.addAction(world, `Fauceted ${amount.show()} ERC-20 tokens to ${address}`, invokation);
    return world;
}
async function transfer(world, from, erc20, address, amount) {
    let invokation = await Invokation_1.invoke(world, erc20.methods.transfer(address, amount.encode()), from, ErrorReporter_1.CTokenErrorReporter);
    world = World_1.addAction(world, `Transferred ${amount.show()} ERC-20 tokens from ${from} to ${address}`, invokation);
    return world;
}
async function transferFrom(world, from, erc20, owner, spender, amount) {
    let invokation = await Invokation_1.invoke(world, erc20.methods.transferFrom(owner, spender, amount.encode()), from, ErrorReporter_1.CTokenErrorReporter);
    world = World_1.addAction(world, `"Transferred from" ${amount.show()} ERC-20 tokens from ${owner} to ${spender}`, invokation);
    return world;
}
async function setFail(world, from, erc20, fail) {
    let invokation = await Invokation_1.invoke(world, erc20.methods.setFail(fail), from, ErrorReporter_1.CTokenErrorReporter);
    world = World_1.addAction(world, `Set fail for ${erc20.name} to ${fail}`, invokation);
    return world;
}
async function setPaused(world, from, erc20, pause) {
    let method = pause ? erc20.methods.pause() : erc20.methods.unpause();
    let invokation = await Invokation_1.invoke(world, method, from);
    world = World_1.addAction(world, `Set ${erc20.name} ${pause ? 'paused' : 'unpaused'}`, invokation);
    return world;
}
async function setFee(world, from, erc20, basisPointFee, maxFee) {
    let invokation = await Invokation_1.invoke(world, erc20.methods.setParams(basisPointFee.encode(), maxFee.encode()), from);
    world = World_1.addAction(world, `Set fee on ${erc20.name} to ${basisPointFee} with a max of ${maxFee}`, invokation);
    return world;
}
function erc20Commands() {
    return [
        new Command_1.Command(`
        #### Deploy

        * "Erc20 Deploy ...erc20Params" - Generates a new ERC-20 token by name
          * E.g. "Erc20 Deploy ZRX ..."
      `, "Deploy", [new Command_1.Arg("erc20Params", CoreValue_1.getEventV, { variadic: true })], (world, from, { erc20Params }) => genToken(world, from, erc20Params.val)),
        new Command_1.View(`
        #### Verify

        * "Erc20 <erc20> Verify apiKey:<String>" - Verifies Erc20 in Etherscan
          * E.g. "Erc20 ZRX Verify "myApiKey"
      `, "Verify", [
            new Command_1.Arg("erc20Arg", CoreValue_1.getStringV),
            new Command_1.Arg("apiKey", CoreValue_1.getStringV)
        ], async (world, { erc20Arg, apiKey }) => {
            let [erc20, name, data] = await ContractLookup_1.getErc20Data(world, erc20Arg.val);
            return await verifyErc20(world, erc20, name, data.get('contract'), apiKey.val);
        }, { namePos: 1 }),
        new Command_1.Command(`
        #### Approve

        * "Erc20 <Erc20> Approve spender:<Address> <Amount>" - Adds an allowance between user and address
          * E.g. "Erc20 ZRX Approve cZRX 1.0e18"
      `, "Approve", [
            new Command_1.Arg("erc20", Erc20Value_1.getErc20V),
            new Command_1.Arg("spender", CoreValue_1.getAddressV),
            new Command_1.Arg("amount", CoreValue_1.getNumberV)
        ], (world, from, { erc20, spender, amount }) => {
            return approve(world, from, erc20, spender.val, amount);
        }, { namePos: 1 }),
        new Command_1.Command(`
        #### Faucet

        * "Erc20 <Erc20> Faucet recipient:<User> <Amount>" - Adds an arbitrary balance to given user
          * E.g. "Erc20 ZRX Faucet Geoff 1.0e18"
      `, "Faucet", [
            new Command_1.Arg("erc20", Erc20Value_1.getErc20V),
            new Command_1.Arg("recipient", CoreValue_1.getAddressV),
            new Command_1.Arg("amount", CoreValue_1.getNumberV)
        ], (world, from, { erc20, recipient, amount }) => {
            return faucet(world, from, erc20, recipient.val, amount);
        }, { namePos: 1 }),
        new Command_1.Command(`
        #### Transfer

        * "Erc20 <Erc20> Transfer recipient:<User> <Amount>" - Transfers a number of tokens via "transfer" as given user to recipient (this does not depend on allowance)
          * E.g. "Erc20 ZRX Transfer Torrey 1.0e18"
      `, "Transfer", [
            new Command_1.Arg("erc20", Erc20Value_1.getErc20V),
            new Command_1.Arg("recipient", CoreValue_1.getAddressV),
            new Command_1.Arg("amount", CoreValue_1.getNumberV)
        ], (world, from, { erc20, recipient, amount }) => transfer(world, from, erc20, recipient.val, amount), { namePos: 1 }),
        new Command_1.Command(`
        #### TransferFrom

        * "Erc20 <Erc20> TransferFrom owner:<User> spender:<User> <Amount>" - Transfers a number of tokens via "transfeFrom" to recipient (this depends on allowances)
          * E.g. "Erc20 ZRX TransferFrom Geoff Torrey 1.0e18"
      `, "TransferFrom", [
            new Command_1.Arg("erc20", Erc20Value_1.getErc20V),
            new Command_1.Arg("owner", CoreValue_1.getAddressV),
            new Command_1.Arg("spender", CoreValue_1.getAddressV),
            new Command_1.Arg("amount", CoreValue_1.getNumberV)
        ], (world, from, { erc20, owner, spender, amount }) => transferFrom(world, from, erc20, owner.val, spender.val, amount), { namePos: 1 }),
        new Command_1.Command(`
        #### SetFail

        * "Erc20 <Erc20> SetFail fail:<Bool>" - Sets failure on or off for an EvilToken
          * E.g. "Erc20 EVL SetFail False"
      `, "SetFail", [
            new Command_1.Arg("erc20", Erc20Value_1.getErc20V),
            new Command_1.Arg("fail", CoreValue_1.getBoolV)
        ], (world, from, { erc20, fail }) => setFail(world, from, erc20, fail.val), { namePos: 1 }),
        new Command_1.Command(`
        #### Pause

        * "Erc20 <Erc20> Pause paused:<Bool>" - Sets paused on or off for WBTC
          * E.g. "Erc20 WBTC Pause"
          * E.g. "Erc20 WBTC Pause False"
      `, "Pause", [
            new Command_1.Arg("erc20", Erc20Value_1.getErc20V),
            new Command_1.Arg("paused", CoreValue_1.getBoolV, { default: new Value_1.BoolV(true) })
        ], (world, from, { erc20, paused }) => setPaused(world, from, erc20, paused.val), { namePos: 1 }),
        new Command_1.Command(`
        #### SetFee

        * "Erc20 <Erc20> SetFee basisPointFee:<Number> maxFee:<Number>" - Sets the current fee and max fee on Tether. Current 
        * Current fee (basisPointFee) has a max of 20 basis points, while maxFee is capped at 50 Tether (a max absolute fee of 50 * 10 ^ decimals)
          * E.g. "Erc20 USDT SetFee 10 10"
      `, "SetFee", [
            new Command_1.Arg("erc20", Erc20Value_1.getErc20V),
            new Command_1.Arg("basisPointFee", CoreValue_1.getNumberV),
            new Command_1.Arg("maxFee", CoreValue_1.getNumberV)
        ], (world, from, { erc20, basisPointFee, maxFee }) => setFee(world, from, erc20, basisPointFee, maxFee), { namePos: 1 })
    ];
}
exports.erc20Commands = erc20Commands;
async function processErc20Event(world, event, from) {
    return await Command_1.processCommandEvent("Erc20", erc20Commands(), world, event, from);
}
exports.processErc20Event = processErc20Event;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXJjMjBFdmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9FdmVudC9FcmMyMEV2ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLG9DQUEwQztBQUUxQyw4Q0FBcUM7QUFDckMsMERBQW1EO0FBQ25ELDRDQU1zQjtBQUN0QixvQ0FLMkI7QUFDM0Isb0RBQThDO0FBQzlDLHNDQUFpQztBQUNqQyx3Q0FBbUU7QUFDbkUsb0RBQXFEO0FBRXJELHNEQUErQztBQUUvQyxLQUFLLFVBQVUsUUFBUSxDQUFDLEtBQVksRUFBRSxJQUFZLEVBQUUsTUFBYTtJQUMvRCxJQUFJLEVBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLEdBQUcsTUFBTSx5QkFBVSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDaEYsS0FBSyxHQUFHLFFBQVEsQ0FBQztJQUVqQixLQUFLLEdBQUcsaUJBQVMsQ0FDZixLQUFLLEVBQ0wsc0JBQXNCLFNBQVMsQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFDLFdBQVcsZ0JBQWdCLEtBQUssQ0FBQyxRQUFRLEVBQUUsRUFDaEcsU0FBUyxDQUFDLFVBQVUsQ0FDckIsQ0FBQztJQUVGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxXQUFXLENBQUMsS0FBWSxFQUFFLEtBQVksRUFBRSxJQUFZLEVBQUUsUUFBZ0IsRUFBRSxNQUFjO0lBQ25HLElBQUksS0FBSyxDQUFDLGNBQWMsRUFBRSxFQUFFO1FBQzFCLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGtEQUFrRCxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztLQUM3RjtTQUFNO1FBQ0wsTUFBTSxlQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUM3RDtJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxPQUFPLENBQUMsS0FBWSxFQUFFLElBQVksRUFBRSxLQUFZLEVBQUUsT0FBZSxFQUFFLE1BQWU7SUFDL0YsSUFBSSxVQUFVLEdBQUcsTUFBTSxtQkFBTSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLG1DQUFtQixDQUFDLENBQUM7SUFFakgsS0FBSyxHQUFHLGlCQUFTLENBQ2YsS0FBSyxFQUNMLFlBQVksS0FBSyxDQUFDLElBQUkscUJBQXFCLElBQUksT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFDckUsVUFBVSxDQUNYLENBQUM7SUFFRixPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFFRCxLQUFLLFVBQVUsTUFBTSxDQUFDLEtBQVksRUFBRSxJQUFZLEVBQUUsS0FBWSxFQUFFLE9BQWUsRUFBRSxNQUFlO0lBQzlGLElBQUksVUFBVSxHQUFHLE1BQU0sbUJBQU0sQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxtQ0FBbUIsQ0FBQyxDQUFDO0lBRXBILEtBQUssR0FBRyxpQkFBUyxDQUNmLEtBQUssRUFDTCxZQUFZLE1BQU0sQ0FBQyxJQUFJLEVBQUUscUJBQXFCLE9BQU8sRUFBRSxFQUN2RCxVQUFVLENBQ1gsQ0FBQztJQUVGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxRQUFRLENBQUMsS0FBWSxFQUFFLElBQVksRUFBRSxLQUFZLEVBQUUsT0FBZSxFQUFFLE1BQWU7SUFDaEcsSUFBSSxVQUFVLEdBQUcsTUFBTSxtQkFBTSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLG1DQUFtQixDQUFDLENBQUM7SUFFbEgsS0FBSyxHQUFHLGlCQUFTLENBQ2YsS0FBSyxFQUNMLGVBQWUsTUFBTSxDQUFDLElBQUksRUFBRSx1QkFBdUIsSUFBSSxPQUFPLE9BQU8sRUFBRSxFQUN2RSxVQUFVLENBQ1gsQ0FBQztJQUVGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxZQUFZLENBQUMsS0FBWSxFQUFFLElBQVksRUFBRSxLQUFZLEVBQUUsS0FBYSxFQUFFLE9BQWUsRUFBRSxNQUFlO0lBQ25ILElBQUksVUFBVSxHQUFHLE1BQU0sbUJBQU0sQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsbUNBQW1CLENBQUMsQ0FBQztJQUU3SCxLQUFLLEdBQUcsaUJBQVMsQ0FDZixLQUFLLEVBQ0wsc0JBQXNCLE1BQU0sQ0FBQyxJQUFJLEVBQUUsdUJBQXVCLEtBQUssT0FBTyxPQUFPLEVBQUUsRUFDL0UsVUFBVSxDQUNYLENBQUM7SUFFRixPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFFRCxLQUFLLFVBQVUsT0FBTyxDQUFDLEtBQVksRUFBRSxJQUFZLEVBQUUsS0FBWSxFQUFFLElBQWE7SUFDNUUsSUFBSSxVQUFVLEdBQUcsTUFBTSxtQkFBTSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsbUNBQW1CLENBQUMsQ0FBQztJQUU3RixLQUFLLEdBQUcsaUJBQVMsQ0FDZixLQUFLLEVBQ0wsZ0JBQWdCLEtBQUssQ0FBQyxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQ3ZDLFVBQVUsQ0FDWCxDQUFDO0lBRUYsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsS0FBSyxVQUFVLFNBQVMsQ0FBQyxLQUFZLEVBQUUsSUFBWSxFQUFFLEtBQVksRUFBRSxLQUFjO0lBQy9FLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNyRSxJQUFJLFVBQVUsR0FBRyxNQUFNLG1CQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUVuRCxLQUFLLEdBQUcsaUJBQVMsQ0FDZixLQUFLLEVBQ0wsT0FBTyxLQUFLLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFDcEQsVUFBVSxDQUNYLENBQUM7SUFFRixPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFFRCxLQUFLLFVBQVUsTUFBTSxDQUFDLEtBQVksRUFBRSxJQUFZLEVBQUUsS0FBWSxFQUFFLGFBQXNCLEVBQUUsTUFBZTtJQUNyRyxJQUFJLFVBQVUsR0FBRyxNQUFNLG1CQUFNLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsRUFBRSxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUU3RyxLQUFLLEdBQUcsaUJBQVMsQ0FDZixLQUFLLEVBQ0wsY0FBYyxLQUFLLENBQUMsSUFBSSxPQUFPLGFBQWEsa0JBQWtCLE1BQU0sRUFBRSxFQUN0RSxVQUFVLENBQ1gsQ0FBQztJQUVGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELFNBQWdCLGFBQWE7SUFDM0IsT0FBTztRQUNMLElBQUksaUJBQU8sQ0FBd0I7Ozs7O09BS2hDLEVBQ0QsUUFBUSxFQUNSLENBQUMsSUFBSSxhQUFHLENBQUMsYUFBYSxFQUFFLHFCQUFTLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxFQUNyRCxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBQyxXQUFXLEVBQUMsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUN2RTtRQUVELElBQUksY0FBSSxDQUF1Qzs7Ozs7T0FLNUMsRUFDRCxRQUFRLEVBQ1I7WUFDRSxJQUFJLGFBQUcsQ0FBQyxVQUFVLEVBQUUsc0JBQVUsQ0FBQztZQUMvQixJQUFJLGFBQUcsQ0FBQyxRQUFRLEVBQUUsc0JBQVUsQ0FBQztTQUM5QixFQUNELEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBQyxRQUFRLEVBQUUsTUFBTSxFQUFDLEVBQUUsRUFBRTtZQUNsQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxNQUFNLDZCQUFZLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVsRSxPQUFPLE1BQU0sV0FBVyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFFLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xGLENBQUMsRUFDRCxFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUMsQ0FDYjtRQUVELElBQUksaUJBQU8sQ0FBcUQ7Ozs7O09BSzdELEVBQ0QsU0FBUyxFQUNUO1lBQ0UsSUFBSSxhQUFHLENBQUMsT0FBTyxFQUFFLHNCQUFTLENBQUM7WUFDM0IsSUFBSSxhQUFHLENBQUMsU0FBUyxFQUFFLHVCQUFXLENBQUM7WUFDL0IsSUFBSSxhQUFHLENBQUMsUUFBUSxFQUFFLHNCQUFVLENBQUM7U0FDOUIsRUFDRCxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBQyxFQUFFLEVBQUU7WUFDeEMsT0FBTyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQTtRQUN6RCxDQUFDLEVBQ0QsRUFBQyxPQUFPLEVBQUUsQ0FBQyxFQUFDLENBQ2I7UUFFRCxJQUFJLGlCQUFPLENBQXVEOzs7OztPQUsvRCxFQUNELFFBQVEsRUFDUjtZQUNFLElBQUksYUFBRyxDQUFDLE9BQU8sRUFBRSxzQkFBUyxDQUFDO1lBQzNCLElBQUksYUFBRyxDQUFDLFdBQVcsRUFBRSx1QkFBVyxDQUFDO1lBQ2pDLElBQUksYUFBRyxDQUFDLFFBQVEsRUFBRSxzQkFBVSxDQUFDO1NBQzlCLEVBQ0QsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUMsRUFBRSxFQUFFO1lBQzFDLE9BQU8sTUFBTSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFNBQVMsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDMUQsQ0FBQyxFQUNELEVBQUMsT0FBTyxFQUFFLENBQUMsRUFBQyxDQUNiO1FBQ0QsSUFBSSxpQkFBTyxDQUF1RDs7Ozs7T0FLL0QsRUFDRCxVQUFVLEVBQ1Y7WUFDRSxJQUFJLGFBQUcsQ0FBQyxPQUFPLEVBQUUsc0JBQVMsQ0FBQztZQUMzQixJQUFJLGFBQUcsQ0FBQyxXQUFXLEVBQUUsdUJBQVcsQ0FBQztZQUNqQyxJQUFJLGFBQUcsQ0FBQyxRQUFRLEVBQUUsc0JBQVUsQ0FBQztTQUM5QixFQUNELENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFDLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxFQUNoRyxFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUMsQ0FDYjtRQUNELElBQUksaUJBQU8sQ0FBc0U7Ozs7O09BSzlFLEVBQ0QsY0FBYyxFQUNkO1lBQ0UsSUFBSSxhQUFHLENBQUMsT0FBTyxFQUFFLHNCQUFTLENBQUM7WUFDM0IsSUFBSSxhQUFHLENBQUMsT0FBTyxFQUFFLHVCQUFXLENBQUM7WUFDN0IsSUFBSSxhQUFHLENBQUMsU0FBUyxFQUFFLHVCQUFXLENBQUM7WUFDL0IsSUFBSSxhQUFHLENBQUMsUUFBUSxFQUFFLHNCQUFVLENBQUM7U0FDOUIsRUFDRCxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUMsRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsRUFDbEgsRUFBQyxPQUFPLEVBQUUsQ0FBQyxFQUFDLENBQ2I7UUFDRCxJQUFJLGlCQUFPLENBQThCOzs7OztPQUt0QyxFQUNELFNBQVMsRUFDVDtZQUNFLElBQUksYUFBRyxDQUFDLE9BQU8sRUFBRSxzQkFBUyxDQUFDO1lBQzNCLElBQUksYUFBRyxDQUFDLE1BQU0sRUFBRSxvQkFBUSxDQUFDO1NBQzFCLEVBQ0QsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBQyxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUNyRSxFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUMsQ0FDYjtRQUNELElBQUksaUJBQU8sQ0FBZ0M7Ozs7OztPQU14QyxFQUNELE9BQU8sRUFDUDtZQUNFLElBQUksYUFBRyxDQUFDLE9BQU8sRUFBRSxzQkFBUyxDQUFDO1lBQzNCLElBQUksYUFBRyxDQUFDLFFBQVEsRUFBRSxvQkFBUSxFQUFFLEVBQUMsT0FBTyxFQUFFLElBQUksYUFBSyxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUM7U0FDeEQsRUFDRCxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBQyxLQUFLLEVBQUUsTUFBTSxFQUFDLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQzNFLEVBQUMsT0FBTyxFQUFFLENBQUMsRUFBQyxDQUNiO1FBQ0QsSUFBSSxpQkFBTyxDQUEwRDs7Ozs7O09BTWxFLEVBQ0QsUUFBUSxFQUNSO1lBQ0UsSUFBSSxhQUFHLENBQUMsT0FBTyxFQUFFLHNCQUFTLENBQUM7WUFDM0IsSUFBSSxhQUFHLENBQUMsZUFBZSxFQUFFLHNCQUFVLENBQUM7WUFDcEMsSUFBSSxhQUFHLENBQUMsUUFBUSxFQUFFLHNCQUFVLENBQUM7U0FDOUIsRUFDRCxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBQyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLE1BQU0sQ0FBQyxFQUNsRyxFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUMsQ0FDYjtLQUNGLENBQUM7QUFDSixDQUFDO0FBaEpELHNDQWdKQztBQUVNLEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxLQUFZLEVBQUUsS0FBWSxFQUFFLElBQW1CO0lBQ3JGLE9BQU8sTUFBTSw2QkFBbUIsQ0FBTSxPQUFPLEVBQUUsYUFBYSxFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztBQUN0RixDQUFDO0FBRkQsOENBRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0V2ZW50fSBmcm9tICcuLi9FdmVudCc7XG5pbXBvcnQge2FkZEFjdGlvbiwgV29ybGR9IGZyb20gJy4uL1dvcmxkJztcbmltcG9ydCB7RXJjMjB9IGZyb20gJy4uL0NvbnRyYWN0L0VyYzIwJztcbmltcG9ydCB7aW52b2tlfSBmcm9tICcuLi9JbnZva2F0aW9uJztcbmltcG9ydCB7YnVpbGRFcmMyMH0gZnJvbSAnLi4vQnVpbGRlci9FcmMyMEJ1aWxkZXInO1xuaW1wb3J0IHtcbiAgZ2V0QWRkcmVzc1YsXG4gIGdldEJvb2xWLFxuICBnZXRFdmVudFYsXG4gIGdldE51bWJlclYsXG4gIGdldFN0cmluZ1Zcbn0gZnJvbSAnLi4vQ29yZVZhbHVlJztcbmltcG9ydCB7XG4gIEFkZHJlc3NWLFxuICBCb29sVixcbiAgRXZlbnRWLFxuICBOdW1iZXJWLFxuICBTdHJpbmdWfSBmcm9tICcuLi9WYWx1ZSc7XG5pbXBvcnQge2dldEVyYzIwVn0gZnJvbSAnLi4vVmFsdWUvRXJjMjBWYWx1ZSc7XG5pbXBvcnQge3ZlcmlmeX0gZnJvbSAnLi4vVmVyaWZ5JztcbmltcG9ydCB7QXJnLCBDb21tYW5kLCBWaWV3LCBwcm9jZXNzQ29tbWFuZEV2ZW50fSBmcm9tICcuLi9Db21tYW5kJztcbmltcG9ydCB7Q1Rva2VuRXJyb3JSZXBvcnRlcn0gZnJvbSAnLi4vRXJyb3JSZXBvcnRlcic7XG5pbXBvcnQge2VuY29kZWROdW1iZXJ9IGZyb20gJy4uL0VuY29kaW5nJztcbmltcG9ydCB7Z2V0RXJjMjBEYXRhfSBmcm9tICcuLi9Db250cmFjdExvb2t1cCc7XG5cbmFzeW5jIGZ1bmN0aW9uIGdlblRva2VuKHdvcmxkOiBXb3JsZCwgZnJvbTogc3RyaW5nLCBwYXJhbXM6IEV2ZW50KTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQge3dvcmxkOiBuZXdXb3JsZCwgZXJjMjAsIHRva2VuRGF0YX0gPSBhd2FpdCBidWlsZEVyYzIwKHdvcmxkLCBmcm9tLCBwYXJhbXMpO1xuICB3b3JsZCA9IG5ld1dvcmxkO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBBZGRlZCBFUkMtMjAgdG9rZW4gJHt0b2tlbkRhdGEuc3ltYm9sfSAoJHt0b2tlbkRhdGEuZGVzY3JpcHRpb259KSBhdCBhZGRyZXNzICR7ZXJjMjAuX2FkZHJlc3N9YCxcbiAgICB0b2tlbkRhdGEuaW52b2thdGlvblxuICApO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5RXJjMjAod29ybGQ6IFdvcmxkLCBlcmMyMDogRXJjMjAsIG5hbWU6IHN0cmluZywgY29udHJhY3Q6IHN0cmluZywgYXBpS2V5OiBzdHJpbmcpOiBQcm9taXNlPFdvcmxkPiB7XG4gIGlmICh3b3JsZC5pc0xvY2FsTmV0d29yaygpKSB7XG4gICAgd29ybGQucHJpbnRlci5wcmludExpbmUoYFBvbGl0ZWx5IGRlY2xpbmluZyB0byB2ZXJpZnkgb24gbG9jYWwgbmV0d29yazogJHt3b3JsZC5uZXR3b3JrfS5gKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB2ZXJpZnkod29ybGQsIGFwaUtleSwgbmFtZSwgY29udHJhY3QsIGVyYzIwLl9hZGRyZXNzKTtcbiAgfVxuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gYXBwcm92ZSh3b3JsZDogV29ybGQsIGZyb206IHN0cmluZywgZXJjMjA6IEVyYzIwLCBhZGRyZXNzOiBzdHJpbmcsIGFtb3VudDogTnVtYmVyVik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2Uod29ybGQsIGVyYzIwLm1ldGhvZHMuYXBwcm92ZShhZGRyZXNzLCBhbW91bnQuZW5jb2RlKCkpLCBmcm9tLCBDVG9rZW5FcnJvclJlcG9ydGVyKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgQXBwcm92ZWQgJHtlcmMyMC5uYW1lfSBFUkMtMjAgdG9rZW4gZm9yICR7ZnJvbX0gb2YgJHthbW91bnQuc2hvdygpfWAsXG4gICAgaW52b2thdGlvblxuICApO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmF1Y2V0KHdvcmxkOiBXb3JsZCwgZnJvbTogc3RyaW5nLCBlcmMyMDogRXJjMjAsIGFkZHJlc3M6IHN0cmluZywgYW1vdW50OiBOdW1iZXJWKTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZSh3b3JsZCwgZXJjMjAubWV0aG9kcy5hbGxvY2F0ZVRvKGFkZHJlc3MsIGFtb3VudC5lbmNvZGUoKSksIGZyb20sIENUb2tlbkVycm9yUmVwb3J0ZXIpO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBGYXVjZXRlZCAke2Ftb3VudC5zaG93KCl9IEVSQy0yMCB0b2tlbnMgdG8gJHthZGRyZXNzfWAsXG4gICAgaW52b2thdGlvblxuICApO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdHJhbnNmZXIod29ybGQ6IFdvcmxkLCBmcm9tOiBzdHJpbmcsIGVyYzIwOiBFcmMyMCwgYWRkcmVzczogc3RyaW5nLCBhbW91bnQ6IE51bWJlclYpOiBQcm9taXNlPFdvcmxkPiB7XG4gIGxldCBpbnZva2F0aW9uID0gYXdhaXQgaW52b2tlKHdvcmxkLCBlcmMyMC5tZXRob2RzLnRyYW5zZmVyKGFkZHJlc3MsIGFtb3VudC5lbmNvZGUoKSksIGZyb20sIENUb2tlbkVycm9yUmVwb3J0ZXIpO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBUcmFuc2ZlcnJlZCAke2Ftb3VudC5zaG93KCl9IEVSQy0yMCB0b2tlbnMgZnJvbSAke2Zyb219IHRvICR7YWRkcmVzc31gLFxuICAgIGludm9rYXRpb25cbiAgKTtcblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSh3b3JsZDogV29ybGQsIGZyb206IHN0cmluZywgZXJjMjA6IEVyYzIwLCBvd25lcjogc3RyaW5nLCBzcGVuZGVyOiBzdHJpbmcsIGFtb3VudDogTnVtYmVyVik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2Uod29ybGQsIGVyYzIwLm1ldGhvZHMudHJhbnNmZXJGcm9tKG93bmVyLCBzcGVuZGVyLCBhbW91bnQuZW5jb2RlKCkpLCBmcm9tLCBDVG9rZW5FcnJvclJlcG9ydGVyKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgXCJUcmFuc2ZlcnJlZCBmcm9tXCIgJHthbW91bnQuc2hvdygpfSBFUkMtMjAgdG9rZW5zIGZyb20gJHtvd25lcn0gdG8gJHtzcGVuZGVyfWAsXG4gICAgaW52b2thdGlvblxuICApO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0RmFpbCh3b3JsZDogV29ybGQsIGZyb206IHN0cmluZywgZXJjMjA6IEVyYzIwLCBmYWlsOiBib29sZWFuKTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZSh3b3JsZCwgZXJjMjAubWV0aG9kcy5zZXRGYWlsKGZhaWwpLCBmcm9tLCBDVG9rZW5FcnJvclJlcG9ydGVyKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgU2V0IGZhaWwgZm9yICR7ZXJjMjAubmFtZX0gdG8gJHtmYWlsfWAsXG4gICAgaW52b2thdGlvblxuICApO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0UGF1c2VkKHdvcmxkOiBXb3JsZCwgZnJvbTogc3RyaW5nLCBlcmMyMDogRXJjMjAsIHBhdXNlOiBib29sZWFuKTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgbWV0aG9kID0gcGF1c2UgPyBlcmMyMC5tZXRob2RzLnBhdXNlKCkgOiBlcmMyMC5tZXRob2RzLnVucGF1c2UoKTtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2Uod29ybGQsIG1ldGhvZCwgZnJvbSk7XG5cbiAgd29ybGQgPSBhZGRBY3Rpb24oXG4gICAgd29ybGQsXG4gICAgYFNldCAke2VyYzIwLm5hbWV9ICR7cGF1c2UgPyAncGF1c2VkJyA6ICd1bnBhdXNlZCd9YCxcbiAgICBpbnZva2F0aW9uXG4gICk7XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRGZWUod29ybGQ6IFdvcmxkLCBmcm9tOiBzdHJpbmcsIGVyYzIwOiBFcmMyMCwgYmFzaXNQb2ludEZlZTogTnVtYmVyViwgbWF4RmVlOiBOdW1iZXJWKTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZSh3b3JsZCwgZXJjMjAubWV0aG9kcy5zZXRQYXJhbXMoYmFzaXNQb2ludEZlZS5lbmNvZGUoKSwgbWF4RmVlLmVuY29kZSgpKSwgZnJvbSk7XG5cbiAgd29ybGQgPSBhZGRBY3Rpb24oXG4gICAgd29ybGQsXG4gICAgYFNldCBmZWUgb24gJHtlcmMyMC5uYW1lfSB0byAke2Jhc2lzUG9pbnRGZWV9IHdpdGggYSBtYXggb2YgJHttYXhGZWV9YCxcbiAgICBpbnZva2F0aW9uXG4gICk7XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXJjMjBDb21tYW5kcygpIHtcbiAgcmV0dXJuIFtcbiAgICBuZXcgQ29tbWFuZDx7ZXJjMjBQYXJhbXM6IEV2ZW50Vn0+KGBcbiAgICAgICAgIyMjIyBEZXBsb3lcblxuICAgICAgICAqIFwiRXJjMjAgRGVwbG95IC4uLmVyYzIwUGFyYW1zXCIgLSBHZW5lcmF0ZXMgYSBuZXcgRVJDLTIwIHRva2VuIGJ5IG5hbWVcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBEZXBsb3kgWlJYIC4uLlwiXG4gICAgICBgLFxuICAgICAgXCJEZXBsb3lcIixcbiAgICAgIFtuZXcgQXJnKFwiZXJjMjBQYXJhbXNcIiwgZ2V0RXZlbnRWLCB7dmFyaWFkaWM6IHRydWV9KV0sXG4gICAgICAod29ybGQsIGZyb20sIHtlcmMyMFBhcmFtc30pID0+IGdlblRva2VuKHdvcmxkLCBmcm9tLCBlcmMyMFBhcmFtcy52YWwpXG4gICAgKSxcblxuICAgIG5ldyBWaWV3PHtlcmMyMEFyZzogU3RyaW5nViwgYXBpS2V5OiBTdHJpbmdWfT4oYFxuICAgICAgICAjIyMjIFZlcmlmeVxuXG4gICAgICAgICogXCJFcmMyMCA8ZXJjMjA+IFZlcmlmeSBhcGlLZXk6PFN0cmluZz5cIiAtIFZlcmlmaWVzIEVyYzIwIGluIEV0aGVyc2NhblxuICAgICAgICAgICogRS5nLiBcIkVyYzIwIFpSWCBWZXJpZnkgXCJteUFwaUtleVwiXG4gICAgICBgLFxuICAgICAgXCJWZXJpZnlcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImVyYzIwQXJnXCIsIGdldFN0cmluZ1YpLFxuICAgICAgICBuZXcgQXJnKFwiYXBpS2V5XCIsIGdldFN0cmluZ1YpXG4gICAgICBdLFxuICAgICAgYXN5bmMgKHdvcmxkLCB7ZXJjMjBBcmcsIGFwaUtleX0pID0+IHtcbiAgICAgICAgbGV0IFtlcmMyMCwgbmFtZSwgZGF0YV0gPSBhd2FpdCBnZXRFcmMyMERhdGEod29ybGQsIGVyYzIwQXJnLnZhbCk7XG5cbiAgICAgICAgcmV0dXJuIGF3YWl0IHZlcmlmeUVyYzIwKHdvcmxkLCBlcmMyMCwgbmFtZSwgZGF0YS5nZXQoJ2NvbnRyYWN0JykhLCBhcGlLZXkudmFsKTtcbiAgICAgIH0sXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuXG4gICAgbmV3IENvbW1hbmQ8e2VyYzIwOiBFcmMyMCwgc3BlbmRlcjogQWRkcmVzc1YsIGFtb3VudDogTnVtYmVyVn0+KGBcbiAgICAgICAgIyMjIyBBcHByb3ZlXG5cbiAgICAgICAgKiBcIkVyYzIwIDxFcmMyMD4gQXBwcm92ZSBzcGVuZGVyOjxBZGRyZXNzPiA8QW1vdW50PlwiIC0gQWRkcyBhbiBhbGxvd2FuY2UgYmV0d2VlbiB1c2VyIGFuZCBhZGRyZXNzXG4gICAgICAgICAgKiBFLmcuIFwiRXJjMjAgWlJYIEFwcHJvdmUgY1pSWCAxLjBlMThcIlxuICAgICAgYCxcbiAgICAgIFwiQXBwcm92ZVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZXJjMjBcIiwgZ2V0RXJjMjBWKSxcbiAgICAgICAgbmV3IEFyZyhcInNwZW5kZXJcIiwgZ2V0QWRkcmVzc1YpLFxuICAgICAgICBuZXcgQXJnKFwiYW1vdW50XCIsIGdldE51bWJlclYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7ZXJjMjAsIHNwZW5kZXIsIGFtb3VudH0pID0+IHtcbiAgICAgICAgcmV0dXJuIGFwcHJvdmUod29ybGQsIGZyb20sIGVyYzIwLCBzcGVuZGVyLnZhbCwgYW1vdW50KVxuICAgICAgfSxcbiAgICAgIHtuYW1lUG9zOiAxfVxuICAgICksXG5cbiAgICBuZXcgQ29tbWFuZDx7ZXJjMjA6IEVyYzIwLCByZWNpcGllbnQ6IEFkZHJlc3NWLCBhbW91bnQ6IE51bWJlclZ9PihgXG4gICAgICAgICMjIyMgRmF1Y2V0XG5cbiAgICAgICAgKiBcIkVyYzIwIDxFcmMyMD4gRmF1Y2V0IHJlY2lwaWVudDo8VXNlcj4gPEFtb3VudD5cIiAtIEFkZHMgYW4gYXJiaXRyYXJ5IGJhbGFuY2UgdG8gZ2l2ZW4gdXNlclxuICAgICAgICAgICogRS5nLiBcIkVyYzIwIFpSWCBGYXVjZXQgR2VvZmYgMS4wZTE4XCJcbiAgICAgIGAsXG4gICAgICBcIkZhdWNldFwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZXJjMjBcIiwgZ2V0RXJjMjBWKSxcbiAgICAgICAgbmV3IEFyZyhcInJlY2lwaWVudFwiLCBnZXRBZGRyZXNzViksXG4gICAgICAgIG5ldyBBcmcoXCJhbW91bnRcIiwgZ2V0TnVtYmVyVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHtlcmMyMCwgcmVjaXBpZW50LCBhbW91bnR9KSA9PiB7XG4gICAgICAgIHJldHVybiBmYXVjZXQod29ybGQsIGZyb20sIGVyYzIwLCByZWNpcGllbnQudmFsLCBhbW91bnQpXG4gICAgICB9LFxuICAgICAge25hbWVQb3M6IDF9XG4gICAgKSxcbiAgICBuZXcgQ29tbWFuZDx7ZXJjMjA6IEVyYzIwLCByZWNpcGllbnQ6IEFkZHJlc3NWLCBhbW91bnQ6IE51bWJlclZ9PihgXG4gICAgICAgICMjIyMgVHJhbnNmZXJcblxuICAgICAgICAqIFwiRXJjMjAgPEVyYzIwPiBUcmFuc2ZlciByZWNpcGllbnQ6PFVzZXI+IDxBbW91bnQ+XCIgLSBUcmFuc2ZlcnMgYSBudW1iZXIgb2YgdG9rZW5zIHZpYSBcInRyYW5zZmVyXCIgYXMgZ2l2ZW4gdXNlciB0byByZWNpcGllbnQgKHRoaXMgZG9lcyBub3QgZGVwZW5kIG9uIGFsbG93YW5jZSlcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBaUlggVHJhbnNmZXIgVG9ycmV5IDEuMGUxOFwiXG4gICAgICBgLFxuICAgICAgXCJUcmFuc2ZlclwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZXJjMjBcIiwgZ2V0RXJjMjBWKSxcbiAgICAgICAgbmV3IEFyZyhcInJlY2lwaWVudFwiLCBnZXRBZGRyZXNzViksXG4gICAgICAgIG5ldyBBcmcoXCJhbW91bnRcIiwgZ2V0TnVtYmVyVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHtlcmMyMCwgcmVjaXBpZW50LCBhbW91bnR9KSA9PiB0cmFuc2Zlcih3b3JsZCwgZnJvbSwgZXJjMjAsIHJlY2lwaWVudC52YWwsIGFtb3VudCksXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHtlcmMyMDogRXJjMjAsIG93bmVyOiBBZGRyZXNzViwgc3BlbmRlcjogQWRkcmVzc1YsIGFtb3VudDogTnVtYmVyVn0+KGBcbiAgICAgICAgIyMjIyBUcmFuc2ZlckZyb21cblxuICAgICAgICAqIFwiRXJjMjAgPEVyYzIwPiBUcmFuc2ZlckZyb20gb3duZXI6PFVzZXI+IHNwZW5kZXI6PFVzZXI+IDxBbW91bnQ+XCIgLSBUcmFuc2ZlcnMgYSBudW1iZXIgb2YgdG9rZW5zIHZpYSBcInRyYW5zZmVGcm9tXCIgdG8gcmVjaXBpZW50ICh0aGlzIGRlcGVuZHMgb24gYWxsb3dhbmNlcylcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBaUlggVHJhbnNmZXJGcm9tIEdlb2ZmIFRvcnJleSAxLjBlMThcIlxuICAgICAgYCxcbiAgICAgIFwiVHJhbnNmZXJGcm9tXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJlcmMyMFwiLCBnZXRFcmMyMFYpLFxuICAgICAgICBuZXcgQXJnKFwib3duZXJcIiwgZ2V0QWRkcmVzc1YpLFxuICAgICAgICBuZXcgQXJnKFwic3BlbmRlclwiLCBnZXRBZGRyZXNzViksXG4gICAgICAgIG5ldyBBcmcoXCJhbW91bnRcIiwgZ2V0TnVtYmVyVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHtlcmMyMCwgb3duZXIsIHNwZW5kZXIsIGFtb3VudH0pID0+IHRyYW5zZmVyRnJvbSh3b3JsZCwgZnJvbSwgZXJjMjAsIG93bmVyLnZhbCwgc3BlbmRlci52YWwsIGFtb3VudCksXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHtlcmMyMDogRXJjMjAsIGZhaWw6IEJvb2xWfT4oYFxuICAgICAgICAjIyMjIFNldEZhaWxcblxuICAgICAgICAqIFwiRXJjMjAgPEVyYzIwPiBTZXRGYWlsIGZhaWw6PEJvb2w+XCIgLSBTZXRzIGZhaWx1cmUgb24gb3Igb2ZmIGZvciBhbiBFdmlsVG9rZW5cbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBFVkwgU2V0RmFpbCBGYWxzZVwiXG4gICAgICBgLFxuICAgICAgXCJTZXRGYWlsXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJlcmMyMFwiLCBnZXRFcmMyMFYpLFxuICAgICAgICBuZXcgQXJnKFwiZmFpbFwiLCBnZXRCb29sVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHtlcmMyMCwgZmFpbH0pID0+IHNldEZhaWwod29ybGQsIGZyb20sIGVyYzIwLCBmYWlsLnZhbCksXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHtlcmMyMDogRXJjMjAsIHBhdXNlZDogQm9vbFZ9PihgXG4gICAgICAgICMjIyMgUGF1c2VcblxuICAgICAgICAqIFwiRXJjMjAgPEVyYzIwPiBQYXVzZSBwYXVzZWQ6PEJvb2w+XCIgLSBTZXRzIHBhdXNlZCBvbiBvciBvZmYgZm9yIFdCVENcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBXQlRDIFBhdXNlXCJcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBXQlRDIFBhdXNlIEZhbHNlXCJcbiAgICAgIGAsXG4gICAgICBcIlBhdXNlXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJlcmMyMFwiLCBnZXRFcmMyMFYpLFxuICAgICAgICBuZXcgQXJnKFwicGF1c2VkXCIsIGdldEJvb2xWLCB7ZGVmYXVsdDogbmV3IEJvb2xWKHRydWUpfSlcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHtlcmMyMCwgcGF1c2VkfSkgPT4gc2V0UGF1c2VkKHdvcmxkLCBmcm9tLCBlcmMyMCwgcGF1c2VkLnZhbCksXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHtlcmMyMDogRXJjMjAsIGJhc2lzUG9pbnRGZWU6IE51bWJlclYsIG1heEZlZTogTnVtYmVyVn0+KGBcbiAgICAgICAgIyMjIyBTZXRGZWVcblxuICAgICAgICAqIFwiRXJjMjAgPEVyYzIwPiBTZXRGZWUgYmFzaXNQb2ludEZlZTo8TnVtYmVyPiBtYXhGZWU6PE51bWJlcj5cIiAtIFNldHMgdGhlIGN1cnJlbnQgZmVlIGFuZCBtYXggZmVlIG9uIFRldGhlci4gQ3VycmVudCBcbiAgICAgICAgKiBDdXJyZW50IGZlZSAoYmFzaXNQb2ludEZlZSkgaGFzIGEgbWF4IG9mIDIwIGJhc2lzIHBvaW50cywgd2hpbGUgbWF4RmVlIGlzIGNhcHBlZCBhdCA1MCBUZXRoZXIgKGEgbWF4IGFic29sdXRlIGZlZSBvZiA1MCAqIDEwIF4gZGVjaW1hbHMpXG4gICAgICAgICAgKiBFLmcuIFwiRXJjMjAgVVNEVCBTZXRGZWUgMTAgMTBcIlxuICAgICAgYCxcbiAgICAgIFwiU2V0RmVlXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJlcmMyMFwiLCBnZXRFcmMyMFYpLFxuICAgICAgICBuZXcgQXJnKFwiYmFzaXNQb2ludEZlZVwiLCBnZXROdW1iZXJWKSxcbiAgICAgICAgbmV3IEFyZyhcIm1heEZlZVwiLCBnZXROdW1iZXJWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgZnJvbSwge2VyYzIwLCBiYXNpc1BvaW50RmVlLCBtYXhGZWV9KSA9PiBzZXRGZWUod29ybGQsIGZyb20sIGVyYzIwLCBiYXNpc1BvaW50RmVlLCBtYXhGZWUpLFxuICAgICAge25hbWVQb3M6IDF9XG4gICAgKVxuICBdO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0VyYzIwRXZlbnQod29ybGQ6IFdvcmxkLCBldmVudDogRXZlbnQsIGZyb206IHN0cmluZyB8IG51bGwpOiBQcm9taXNlPFdvcmxkPiB7XG4gIHJldHVybiBhd2FpdCBwcm9jZXNzQ29tbWFuZEV2ZW50PGFueT4oXCJFcmMyMFwiLCBlcmMyMENvbW1hbmRzKCksIHdvcmxkLCBldmVudCwgZnJvbSk7XG59XG4iXX0=
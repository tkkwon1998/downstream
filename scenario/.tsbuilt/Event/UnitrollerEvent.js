"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.processUnitrollerEvent = exports.unitrollerCommands = void 0;
const World_1 = require("../World");
const Invokation_1 = require("../Invokation");
const CoreValue_1 = require("../CoreValue");
const Command_1 = require("../Command");
const ErrorReporter_1 = require("../ErrorReporter");
const UnitrollerBuilder_1 = require("../Builder/UnitrollerBuilder");
const ContractLookup_1 = require("../ContractLookup");
const Verify_1 = require("../Verify");
async function genUnitroller(world, from, params) {
    let { world: nextWorld, unitroller, unitrollerData } = await UnitrollerBuilder_1.buildUnitroller(world, from, params);
    world = nextWorld;
    world = World_1.addAction(world, `Added Unitroller (${unitrollerData.description}) at address ${unitroller._address}`, unitrollerData.invokation);
    return world;
}
async function verifyUnitroller(world, unitroller, apiKey) {
    if (world.isLocalNetwork()) {
        world.printer.printLine(`Politely declining to verify on local network: ${world.network}.`);
    }
    else {
        await Verify_1.verify(world, apiKey, 'Unitroller', 'Unitroller', unitroller._address);
    }
    return world;
}
async function acceptAdmin(world, from, unitroller) {
    let invokation = await Invokation_1.invoke(world, unitroller.methods._acceptAdmin(), from, ErrorReporter_1.ComptrollerErrorReporter);
    world = World_1.addAction(world, `Accept admin as ${from}`, invokation);
    return world;
}
async function setPendingAdmin(world, from, unitroller, pendingAdmin) {
    let invokation = await Invokation_1.invoke(world, unitroller.methods._setPendingAdmin(pendingAdmin), from, ErrorReporter_1.ComptrollerErrorReporter);
    world = World_1.addAction(world, `Set pending admin to ${pendingAdmin}`, invokation);
    return world;
}
async function setPendingImpl(world, from, unitroller, comptrollerImpl) {
    let invokation = await Invokation_1.invoke(world, unitroller.methods._setPendingImplementation(comptrollerImpl._address), from, ErrorReporter_1.ComptrollerErrorReporter);
    world = World_1.addAction(world, `Set pending comptroller impl to ${comptrollerImpl.name}`, invokation);
    return world;
}
function unitrollerCommands() {
    return [
        new Command_1.Command(`
        #### Deploy

        * "Unitroller Deploy ...unitrollerParams" - Generates a new Unitroller
          * E.g. "Unitroller Deploy"
      `, 'Deploy', [new Command_1.Arg('unitrollerParams', CoreValue_1.getEventV, { variadic: true })], (world, from, { unitrollerParams }) => genUnitroller(world, from, unitrollerParams.val)),
        new Command_1.View(`
        #### Verify

        * "Unitroller Verify apiKey:<String>" - Verifies Unitroller in Etherscan
          * E.g. "Unitroller Verify "myApiKey"
      `, 'Verify', [new Command_1.Arg('unitroller', ContractLookup_1.getUnitroller, { implicit: true }), new Command_1.Arg('apiKey', CoreValue_1.getStringV)], (world, { unitroller, apiKey }) => verifyUnitroller(world, unitroller, apiKey.val)),
        new Command_1.Command(`
        #### AcceptAdmin

        * "AcceptAdmin" - Accept admin for this unitroller
          * E.g. "Unitroller AcceptAdmin"
      `, 'AcceptAdmin', [new Command_1.Arg('unitroller', ContractLookup_1.getUnitroller, { implicit: true })], (world, from, { unitroller }) => acceptAdmin(world, from, unitroller)),
        new Command_1.Command(`
        #### SetPendingAdmin

        * "SetPendingAdmin admin:<Admin>" - Sets the pending admin for this unitroller
          * E.g. "Unitroller SetPendingAdmin Jared"
      `, 'SetPendingAdmin', [new Command_1.Arg('unitroller', ContractLookup_1.getUnitroller, { implicit: true }), new Command_1.Arg('pendingAdmin', CoreValue_1.getAddressV)], (world, from, { unitroller, pendingAdmin }) => setPendingAdmin(world, from, unitroller, pendingAdmin.val)),
        new Command_1.Command(`
        #### SetPendingImpl

        * "SetPendingImpl impl:<Impl>" - Sets the pending comptroller implementation for this unitroller
          * E.g. "Unitroller SetPendingImpl MyScenImpl" - Sets the current comptroller implementation to MyScenImpl
      `, 'SetPendingImpl', [
            new Command_1.Arg('unitroller', ContractLookup_1.getUnitroller, { implicit: true }),
            new Command_1.Arg('comptrollerImpl', ContractLookup_1.getComptrollerImpl)
        ], (world, from, { unitroller, comptrollerImpl }) => setPendingImpl(world, from, unitroller, comptrollerImpl))
    ];
}
exports.unitrollerCommands = unitrollerCommands;
async function processUnitrollerEvent(world, event, from) {
    return await Command_1.processCommandEvent('Unitroller', unitrollerCommands(), world, event, from);
}
exports.processUnitrollerEvent = processUnitrollerEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVW5pdHJvbGxlckV2ZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0V2ZW50L1VuaXRyb2xsZXJFdmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxvQ0FBMEQ7QUFHMUQsOENBQXVDO0FBQ3ZDLDRDQUFrRTtBQUVsRSx3Q0FBcUU7QUFDckUsb0RBQTREO0FBQzVELG9FQUErRDtBQUMvRCxzREFBc0U7QUFDdEUsc0NBQW1DO0FBRW5DLEtBQUssVUFBVSxhQUFhLENBQUMsS0FBWSxFQUFFLElBQVksRUFBRSxNQUFhO0lBQ3BFLElBQUksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsR0FBRyxNQUFNLG1DQUFlLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNsRyxLQUFLLEdBQUcsU0FBUyxDQUFDO0lBRWxCLEtBQUssR0FBRyxpQkFBUyxDQUNmLEtBQUssRUFDTCxxQkFBcUIsY0FBYyxDQUFDLFdBQVcsZ0JBQWdCLFVBQVUsQ0FBQyxRQUFRLEVBQUUsRUFDcEYsY0FBYyxDQUFDLFVBQVUsQ0FDMUIsQ0FBQztJQUVGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxnQkFBZ0IsQ0FBQyxLQUFZLEVBQUUsVUFBc0IsRUFBRSxNQUFjO0lBQ2xGLElBQUksS0FBSyxDQUFDLGNBQWMsRUFBRSxFQUFFO1FBQzFCLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGtEQUFrRCxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztLQUM3RjtTQUFNO1FBQ0wsTUFBTSxlQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUM5RTtJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxXQUFXLENBQUMsS0FBWSxFQUFFLElBQVksRUFBRSxVQUFzQjtJQUMzRSxJQUFJLFVBQVUsR0FBRyxNQUFNLG1CQUFNLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLHdDQUF3QixDQUFDLENBQUM7SUFFeEcsS0FBSyxHQUFHLGlCQUFTLENBQUMsS0FBSyxFQUFFLG1CQUFtQixJQUFJLEVBQUUsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUVoRSxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFFRCxLQUFLLFVBQVUsZUFBZSxDQUM1QixLQUFZLEVBQ1osSUFBWSxFQUNaLFVBQXNCLEVBQ3RCLFlBQW9CO0lBRXBCLElBQUksVUFBVSxHQUFHLE1BQU0sbUJBQU0sQ0FDM0IsS0FBSyxFQUNMLFVBQVUsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLEVBQ2pELElBQUksRUFDSix3Q0FBd0IsQ0FDekIsQ0FBQztJQUVGLEtBQUssR0FBRyxpQkFBUyxDQUFDLEtBQUssRUFBRSx3QkFBd0IsWUFBWSxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFFN0UsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsS0FBSyxVQUFVLGNBQWMsQ0FDM0IsS0FBWSxFQUNaLElBQVksRUFDWixVQUFzQixFQUN0QixlQUFnQztJQUVoQyxJQUFJLFVBQVUsR0FBRyxNQUFNLG1CQUFNLENBQzNCLEtBQUssRUFDTCxVQUFVLENBQUMsT0FBTyxDQUFDLHlCQUF5QixDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsRUFDdEUsSUFBSSxFQUNKLHdDQUF3QixDQUN6QixDQUFDO0lBRUYsS0FBSyxHQUFHLGlCQUFTLENBQUMsS0FBSyxFQUFFLG1DQUFtQyxlQUFlLENBQUMsSUFBSSxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFFaEcsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsU0FBZ0Isa0JBQWtCO0lBQ2hDLE9BQU87UUFDTCxJQUFJLGlCQUFPLENBQ1Q7Ozs7O09BS0MsRUFDRCxRQUFRLEVBQ1IsQ0FBQyxJQUFJLGFBQUcsQ0FBQyxrQkFBa0IsRUFBRSxxQkFBUyxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsRUFDNUQsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsZ0JBQWdCLEVBQUUsRUFBRSxFQUFFLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQ3hGO1FBQ0QsSUFBSSxjQUFJLENBQ047Ozs7O09BS0MsRUFDRCxRQUFRLEVBQ1IsQ0FBQyxJQUFJLGFBQUcsQ0FBQyxZQUFZLEVBQUUsOEJBQWEsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksYUFBRyxDQUFDLFFBQVEsRUFBRSxzQkFBVSxDQUFDLENBQUMsRUFDekYsQ0FBQyxLQUFLLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUNuRjtRQUNELElBQUksaUJBQU8sQ0FDVDs7Ozs7T0FLQyxFQUNELGFBQWEsRUFDYixDQUFDLElBQUksYUFBRyxDQUFDLFlBQVksRUFBRSw4QkFBYSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsRUFDMUQsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUN0RTtRQUNELElBQUksaUJBQU8sQ0FDVDs7Ozs7T0FLQyxFQUNELGlCQUFpQixFQUNqQixDQUFDLElBQUksYUFBRyxDQUFDLFlBQVksRUFBRSw4QkFBYSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxhQUFHLENBQUMsY0FBYyxFQUFFLHVCQUFXLENBQUMsQ0FBQyxFQUNoRyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEVBQUUsRUFBRSxDQUM1QyxlQUFlLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUM3RDtRQUNELElBQUksaUJBQU8sQ0FDVDs7Ozs7T0FLQyxFQUNELGdCQUFnQixFQUNoQjtZQUNFLElBQUksYUFBRyxDQUFDLFlBQVksRUFBRSw4QkFBYSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO1lBQ3hELElBQUksYUFBRyxDQUFDLGlCQUFpQixFQUFFLG1DQUFrQixDQUFDO1NBQy9DLEVBQ0QsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsQ0FDL0MsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUMzRDtLQUNGLENBQUM7QUFDSixDQUFDO0FBL0RELGdEQStEQztBQUVNLEtBQUssVUFBVSxzQkFBc0IsQ0FDMUMsS0FBWSxFQUNaLEtBQVksRUFDWixJQUFtQjtJQUVuQixPQUFPLE1BQU0sNkJBQW1CLENBQU0sWUFBWSxFQUFFLGtCQUFrQixFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNoRyxDQUFDO0FBTkQsd0RBTUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudCB9IGZyb20gJy4uL0V2ZW50JztcbmltcG9ydCB7IGFkZEFjdGlvbiwgZGVzY3JpYmVVc2VyLCBXb3JsZCB9IGZyb20gJy4uL1dvcmxkJztcbmltcG9ydCB7IFVuaXRyb2xsZXIgfSBmcm9tICcuLi9Db250cmFjdC9Vbml0cm9sbGVyJztcbmltcG9ydCB7IENvbXB0cm9sbGVySW1wbCB9IGZyb20gJy4uL0NvbnRyYWN0L0NvbXB0cm9sbGVySW1wbCc7XG5pbXBvcnQgeyBpbnZva2UgfSBmcm9tICcuLi9JbnZva2F0aW9uJztcbmltcG9ydCB7IGdldEV2ZW50ViwgZ2V0U3RyaW5nViwgZ2V0QWRkcmVzc1YgfSBmcm9tICcuLi9Db3JlVmFsdWUnO1xuaW1wb3J0IHsgRXZlbnRWLCBTdHJpbmdWLCBBZGRyZXNzViB9IGZyb20gJy4uL1ZhbHVlJztcbmltcG9ydCB7IEFyZywgQ29tbWFuZCwgVmlldywgcHJvY2Vzc0NvbW1hbmRFdmVudCB9IGZyb20gJy4uL0NvbW1hbmQnO1xuaW1wb3J0IHsgQ29tcHRyb2xsZXJFcnJvclJlcG9ydGVyIH0gZnJvbSAnLi4vRXJyb3JSZXBvcnRlcic7XG5pbXBvcnQgeyBidWlsZFVuaXRyb2xsZXIgfSBmcm9tICcuLi9CdWlsZGVyL1VuaXRyb2xsZXJCdWlsZGVyJztcbmltcG9ydCB7IGdldENvbXB0cm9sbGVySW1wbCwgZ2V0VW5pdHJvbGxlciB9IGZyb20gJy4uL0NvbnRyYWN0TG9va3VwJztcbmltcG9ydCB7IHZlcmlmeSB9IGZyb20gJy4uL1ZlcmlmeSc7XG5cbmFzeW5jIGZ1bmN0aW9uIGdlblVuaXRyb2xsZXIod29ybGQ6IFdvcmxkLCBmcm9tOiBzdHJpbmcsIHBhcmFtczogRXZlbnQpOiBQcm9taXNlPFdvcmxkPiB7XG4gIGxldCB7IHdvcmxkOiBuZXh0V29ybGQsIHVuaXRyb2xsZXIsIHVuaXRyb2xsZXJEYXRhIH0gPSBhd2FpdCBidWlsZFVuaXRyb2xsZXIod29ybGQsIGZyb20sIHBhcmFtcyk7XG4gIHdvcmxkID0gbmV4dFdvcmxkO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBBZGRlZCBVbml0cm9sbGVyICgke3VuaXRyb2xsZXJEYXRhLmRlc2NyaXB0aW9ufSkgYXQgYWRkcmVzcyAke3VuaXRyb2xsZXIuX2FkZHJlc3N9YCxcbiAgICB1bml0cm9sbGVyRGF0YS5pbnZva2F0aW9uXG4gICk7XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlVbml0cm9sbGVyKHdvcmxkOiBXb3JsZCwgdW5pdHJvbGxlcjogVW5pdHJvbGxlciwgYXBpS2V5OiBzdHJpbmcpOiBQcm9taXNlPFdvcmxkPiB7XG4gIGlmICh3b3JsZC5pc0xvY2FsTmV0d29yaygpKSB7XG4gICAgd29ybGQucHJpbnRlci5wcmludExpbmUoYFBvbGl0ZWx5IGRlY2xpbmluZyB0byB2ZXJpZnkgb24gbG9jYWwgbmV0d29yazogJHt3b3JsZC5uZXR3b3JrfS5gKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB2ZXJpZnkod29ybGQsIGFwaUtleSwgJ1VuaXRyb2xsZXInLCAnVW5pdHJvbGxlcicsIHVuaXRyb2xsZXIuX2FkZHJlc3MpO1xuICB9XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhY2NlcHRBZG1pbih3b3JsZDogV29ybGQsIGZyb206IHN0cmluZywgdW5pdHJvbGxlcjogVW5pdHJvbGxlcik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2Uod29ybGQsIHVuaXRyb2xsZXIubWV0aG9kcy5fYWNjZXB0QWRtaW4oKSwgZnJvbSwgQ29tcHRyb2xsZXJFcnJvclJlcG9ydGVyKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbih3b3JsZCwgYEFjY2VwdCBhZG1pbiBhcyAke2Zyb219YCwgaW52b2thdGlvbik7XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRQZW5kaW5nQWRtaW4oXG4gIHdvcmxkOiBXb3JsZCxcbiAgZnJvbTogc3RyaW5nLFxuICB1bml0cm9sbGVyOiBVbml0cm9sbGVyLFxuICBwZW5kaW5nQWRtaW46IHN0cmluZ1xuKTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZShcbiAgICB3b3JsZCxcbiAgICB1bml0cm9sbGVyLm1ldGhvZHMuX3NldFBlbmRpbmdBZG1pbihwZW5kaW5nQWRtaW4pLFxuICAgIGZyb20sXG4gICAgQ29tcHRyb2xsZXJFcnJvclJlcG9ydGVyXG4gICk7XG5cbiAgd29ybGQgPSBhZGRBY3Rpb24od29ybGQsIGBTZXQgcGVuZGluZyBhZG1pbiB0byAke3BlbmRpbmdBZG1pbn1gLCBpbnZva2F0aW9uKTtcblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNldFBlbmRpbmdJbXBsKFxuICB3b3JsZDogV29ybGQsXG4gIGZyb206IHN0cmluZyxcbiAgdW5pdHJvbGxlcjogVW5pdHJvbGxlcixcbiAgY29tcHRyb2xsZXJJbXBsOiBDb21wdHJvbGxlckltcGxcbik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2UoXG4gICAgd29ybGQsXG4gICAgdW5pdHJvbGxlci5tZXRob2RzLl9zZXRQZW5kaW5nSW1wbGVtZW50YXRpb24oY29tcHRyb2xsZXJJbXBsLl9hZGRyZXNzKSxcbiAgICBmcm9tLFxuICAgIENvbXB0cm9sbGVyRXJyb3JSZXBvcnRlclxuICApO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKHdvcmxkLCBgU2V0IHBlbmRpbmcgY29tcHRyb2xsZXIgaW1wbCB0byAke2NvbXB0cm9sbGVySW1wbC5uYW1lfWAsIGludm9rYXRpb24pO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVuaXRyb2xsZXJDb21tYW5kcygpIHtcbiAgcmV0dXJuIFtcbiAgICBuZXcgQ29tbWFuZDx7IHVuaXRyb2xsZXJQYXJhbXM6IEV2ZW50ViB9PihcbiAgICAgIGBcbiAgICAgICAgIyMjIyBEZXBsb3lcblxuICAgICAgICAqIFwiVW5pdHJvbGxlciBEZXBsb3kgLi4udW5pdHJvbGxlclBhcmFtc1wiIC0gR2VuZXJhdGVzIGEgbmV3IFVuaXRyb2xsZXJcbiAgICAgICAgICAqIEUuZy4gXCJVbml0cm9sbGVyIERlcGxveVwiXG4gICAgICBgLFxuICAgICAgJ0RlcGxveScsXG4gICAgICBbbmV3IEFyZygndW5pdHJvbGxlclBhcmFtcycsIGdldEV2ZW50ViwgeyB2YXJpYWRpYzogdHJ1ZSB9KV0sXG4gICAgICAod29ybGQsIGZyb20sIHsgdW5pdHJvbGxlclBhcmFtcyB9KSA9PiBnZW5Vbml0cm9sbGVyKHdvcmxkLCBmcm9tLCB1bml0cm9sbGVyUGFyYW1zLnZhbClcbiAgICApLFxuICAgIG5ldyBWaWV3PHsgdW5pdHJvbGxlcjogVW5pdHJvbGxlcjsgYXBpS2V5OiBTdHJpbmdWIH0+KFxuICAgICAgYFxuICAgICAgICAjIyMjIFZlcmlmeVxuXG4gICAgICAgICogXCJVbml0cm9sbGVyIFZlcmlmeSBhcGlLZXk6PFN0cmluZz5cIiAtIFZlcmlmaWVzIFVuaXRyb2xsZXIgaW4gRXRoZXJzY2FuXG4gICAgICAgICAgKiBFLmcuIFwiVW5pdHJvbGxlciBWZXJpZnkgXCJteUFwaUtleVwiXG4gICAgICBgLFxuICAgICAgJ1ZlcmlmeScsXG4gICAgICBbbmV3IEFyZygndW5pdHJvbGxlcicsIGdldFVuaXRyb2xsZXIsIHsgaW1wbGljaXQ6IHRydWUgfSksIG5ldyBBcmcoJ2FwaUtleScsIGdldFN0cmluZ1YpXSxcbiAgICAgICh3b3JsZCwgeyB1bml0cm9sbGVyLCBhcGlLZXkgfSkgPT4gdmVyaWZ5VW5pdHJvbGxlcih3b3JsZCwgdW5pdHJvbGxlciwgYXBpS2V5LnZhbClcbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHsgdW5pdHJvbGxlcjogVW5pdHJvbGxlcjsgcGVuZGluZ0FkbWluOiBBZGRyZXNzViB9PihcbiAgICAgIGBcbiAgICAgICAgIyMjIyBBY2NlcHRBZG1pblxuXG4gICAgICAgICogXCJBY2NlcHRBZG1pblwiIC0gQWNjZXB0IGFkbWluIGZvciB0aGlzIHVuaXRyb2xsZXJcbiAgICAgICAgICAqIEUuZy4gXCJVbml0cm9sbGVyIEFjY2VwdEFkbWluXCJcbiAgICAgIGAsXG4gICAgICAnQWNjZXB0QWRtaW4nLFxuICAgICAgW25ldyBBcmcoJ3VuaXRyb2xsZXInLCBnZXRVbml0cm9sbGVyLCB7IGltcGxpY2l0OiB0cnVlIH0pXSxcbiAgICAgICh3b3JsZCwgZnJvbSwgeyB1bml0cm9sbGVyIH0pID0+IGFjY2VwdEFkbWluKHdvcmxkLCBmcm9tLCB1bml0cm9sbGVyKVxuICAgICksXG4gICAgbmV3IENvbW1hbmQ8eyB1bml0cm9sbGVyOiBVbml0cm9sbGVyOyBwZW5kaW5nQWRtaW46IEFkZHJlc3NWIH0+KFxuICAgICAgYFxuICAgICAgICAjIyMjIFNldFBlbmRpbmdBZG1pblxuXG4gICAgICAgICogXCJTZXRQZW5kaW5nQWRtaW4gYWRtaW46PEFkbWluPlwiIC0gU2V0cyB0aGUgcGVuZGluZyBhZG1pbiBmb3IgdGhpcyB1bml0cm9sbGVyXG4gICAgICAgICAgKiBFLmcuIFwiVW5pdHJvbGxlciBTZXRQZW5kaW5nQWRtaW4gSmFyZWRcIlxuICAgICAgYCxcbiAgICAgICdTZXRQZW5kaW5nQWRtaW4nLFxuICAgICAgW25ldyBBcmcoJ3VuaXRyb2xsZXInLCBnZXRVbml0cm9sbGVyLCB7IGltcGxpY2l0OiB0cnVlIH0pLCBuZXcgQXJnKCdwZW5kaW5nQWRtaW4nLCBnZXRBZGRyZXNzVildLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7IHVuaXRyb2xsZXIsIHBlbmRpbmdBZG1pbiB9KSA9PlxuICAgICAgICBzZXRQZW5kaW5nQWRtaW4od29ybGQsIGZyb20sIHVuaXRyb2xsZXIsIHBlbmRpbmdBZG1pbi52YWwpXG4gICAgKSxcbiAgICBuZXcgQ29tbWFuZDx7IHVuaXRyb2xsZXI6IFVuaXRyb2xsZXI7IGNvbXB0cm9sbGVySW1wbDogQ29tcHRyb2xsZXJJbXBsIH0+KFxuICAgICAgYFxuICAgICAgICAjIyMjIFNldFBlbmRpbmdJbXBsXG5cbiAgICAgICAgKiBcIlNldFBlbmRpbmdJbXBsIGltcGw6PEltcGw+XCIgLSBTZXRzIHRoZSBwZW5kaW5nIGNvbXB0cm9sbGVyIGltcGxlbWVudGF0aW9uIGZvciB0aGlzIHVuaXRyb2xsZXJcbiAgICAgICAgICAqIEUuZy4gXCJVbml0cm9sbGVyIFNldFBlbmRpbmdJbXBsIE15U2NlbkltcGxcIiAtIFNldHMgdGhlIGN1cnJlbnQgY29tcHRyb2xsZXIgaW1wbGVtZW50YXRpb24gdG8gTXlTY2VuSW1wbFxuICAgICAgYCxcbiAgICAgICdTZXRQZW5kaW5nSW1wbCcsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoJ3VuaXRyb2xsZXInLCBnZXRVbml0cm9sbGVyLCB7IGltcGxpY2l0OiB0cnVlIH0pLFxuICAgICAgICBuZXcgQXJnKCdjb21wdHJvbGxlckltcGwnLCBnZXRDb21wdHJvbGxlckltcGwpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7IHVuaXRyb2xsZXIsIGNvbXB0cm9sbGVySW1wbCB9KSA9PlxuICAgICAgICBzZXRQZW5kaW5nSW1wbCh3b3JsZCwgZnJvbSwgdW5pdHJvbGxlciwgY29tcHRyb2xsZXJJbXBsKVxuICAgIClcbiAgXTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NVbml0cm9sbGVyRXZlbnQoXG4gIHdvcmxkOiBXb3JsZCxcbiAgZXZlbnQ6IEV2ZW50LFxuICBmcm9tOiBzdHJpbmcgfCBudWxsXG4pOiBQcm9taXNlPFdvcmxkPiB7XG4gIHJldHVybiBhd2FpdCBwcm9jZXNzQ29tbWFuZEV2ZW50PGFueT4oJ1VuaXRyb2xsZXInLCB1bml0cm9sbGVyQ29tbWFuZHMoKSwgd29ybGQsIGV2ZW50LCBmcm9tKTtcbn1cbiJdfQ==
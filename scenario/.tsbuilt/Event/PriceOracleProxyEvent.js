"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.processPriceOracleProxyEvent = exports.priceOracleProxyCommands = void 0;
const World_1 = require("../World");
const PriceOracleProxyBuilder_1 = require("../Builder/PriceOracleProxyBuilder");
const Invokation_1 = require("../Invokation");
const CoreValue_1 = require("../CoreValue");
const Value_1 = require("../Value");
const Command_1 = require("../Command");
const ContractLookup_1 = require("../ContractLookup");
const Verify_1 = require("../Verify");
async function genPriceOracleProxy(world, from, params) {
    let priceOracleProxy;
    let invokation;
    ({ world, priceOracleProxy, invokation } = await PriceOracleProxyBuilder_1.buildPriceOracleProxy(world, from, params));
    world = World_1.addAction(world, `Deployed PriceOracleProxy to address ${priceOracleProxy._address}`, invokation);
    return world;
}
async function verifyPriceOracleProxy(world, priceOracleProxy, apiKey, contractName) {
    if (world.isLocalNetwork()) {
        world.printer.printLine(`Politely declining to verify on local network: ${world.network}.`);
    }
    else {
        await Verify_1.verify(world, apiKey, "PriceOracleProxy", contractName, priceOracleProxy._address);
    }
    return world;
}
async function setSaiPrice(world, from, priceOracleProxy, amount) {
    return World_1.addAction(world, `Set price oracle SAI price to ${amount.show()}`, await Invokation_1.invoke(world, priceOracleProxy.methods.setSaiPrice(amount.encode()), from));
}
function priceOracleProxyCommands() {
    return [
        new Command_1.Command(`
        #### Deploy

        * "Deploy ...params" - Generates a new price oracle proxy
          * E.g. "PriceOracleProxy Deploy (Unitroller Address) (PriceOracle Address) (cEther Address)"
      `, "Deploy", [
            new Command_1.Arg("params", CoreValue_1.getEventV, { variadic: true })
        ], (world, from, { params }) => genPriceOracleProxy(world, from, params.val)),
        new Command_1.View(`
        #### Verify

        * "Verify apiKey:<String> contractName:<String>=PriceOracleProxy" - Verifies PriceOracleProxy in Etherscan
          * E.g. "PriceOracleProxy Verify "myApiKey"
      `, "Verify", [
            new Command_1.Arg("priceOracleProxy", ContractLookup_1.getPriceOracleProxy, { implicit: true }),
            new Command_1.Arg("apiKey", CoreValue_1.getStringV),
            new Command_1.Arg("contractName", CoreValue_1.getStringV, { default: new Value_1.StringV("PriceOracleProxy") })
        ], (world, { priceOracleProxy, apiKey, contractName }) => verifyPriceOracleProxy(world, priceOracleProxy, apiKey.val, contractName.val)),
        new Command_1.Command(`
        #### SetSaiPrice

        * "SetSaiPrice <Amount>" - Sets the per-ether price for SAI
          * E.g. "PriceOracleProxy SetSaiPrice 1.0"
      `, "SetSaiPrice", [
            new Command_1.Arg("priceOracleProxy", ContractLookup_1.getPriceOracleProxy, { implicit: true }),
            new Command_1.Arg("amount", CoreValue_1.getExpNumberV)
        ], (world, from, { priceOracleProxy, amount }) => setSaiPrice(world, from, priceOracleProxy, amount))
    ];
}
exports.priceOracleProxyCommands = priceOracleProxyCommands;
async function processPriceOracleProxyEvent(world, event, from) {
    return await Command_1.processCommandEvent("PriceOracleProxy", priceOracleProxyCommands(), world, event, from);
}
exports.processPriceOracleProxyEvent = processPriceOracleProxyEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJpY2VPcmFjbGVQcm94eUV2ZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0V2ZW50L1ByaWNlT3JhY2xlUHJveHlFdmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxvQ0FBMEM7QUFFMUMsZ0ZBQXlFO0FBQ3pFLDhDQUFxQztBQUNyQyw0Q0FLc0I7QUFDdEIsb0NBS2tCO0FBQ2xCLHdDQUFtRTtBQUNuRSxzREFBc0Q7QUFDdEQsc0NBQWlDO0FBR2pDLEtBQUssVUFBVSxtQkFBbUIsQ0FBQyxLQUFZLEVBQUUsSUFBWSxFQUFFLE1BQWE7SUFDMUUsSUFBSSxnQkFBZ0IsQ0FBQztJQUNyQixJQUFJLFVBQVUsQ0FBQztJQUVmLENBQUMsRUFBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxFQUFDLEdBQUcsTUFBTSwrQ0FBcUIsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFFM0YsS0FBSyxHQUFHLGlCQUFTLENBQ2YsS0FBSyxFQUNMLHdDQUF3QyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsRUFDbkUsVUFBVSxDQUNYLENBQUM7SUFFRixPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFFRCxLQUFLLFVBQVUsc0JBQXNCLENBQUMsS0FBWSxFQUFFLGdCQUFrQyxFQUFFLE1BQWMsRUFBRSxZQUFvQjtJQUMxSCxJQUFJLEtBQUssQ0FBQyxjQUFjLEVBQUUsRUFBRTtRQUMxQixLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxrREFBa0QsS0FBSyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7S0FDN0Y7U0FBTTtRQUNMLE1BQU0sZUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsa0JBQWtCLEVBQUUsWUFBWSxFQUFFLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQzFGO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsS0FBSyxVQUFVLFdBQVcsQ0FBQyxLQUFZLEVBQUUsSUFBWSxFQUFFLGdCQUFrQyxFQUFFLE1BQWU7SUFDeEcsT0FBTyxpQkFBUyxDQUNkLEtBQUssRUFDTCxpQ0FBaUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFLEVBQ2hELE1BQU0sbUJBQU0sQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FDakYsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFnQix3QkFBd0I7SUFDdEMsT0FBTztRQUNMLElBQUksaUJBQU8sQ0FBbUI7Ozs7O09BSzNCLEVBQ0QsUUFBUSxFQUNSO1lBQ0UsSUFBSSxhQUFHLENBQUMsUUFBUSxFQUFFLHFCQUFTLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUM7U0FDL0MsRUFDRCxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBQyxNQUFNLEVBQUMsRUFBRSxFQUFFLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQ3hFO1FBRUQsSUFBSSxjQUFJLENBQStFOzs7OztPQUtwRixFQUNELFFBQVEsRUFDUjtZQUNFLElBQUksYUFBRyxDQUFDLGtCQUFrQixFQUFFLG9DQUFtQixFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxDQUFDO1lBQ2xFLElBQUksYUFBRyxDQUFDLFFBQVEsRUFBRSxzQkFBVSxDQUFDO1lBQzdCLElBQUksYUFBRyxDQUFDLGNBQWMsRUFBRSxzQkFBVSxFQUFFLEVBQUMsT0FBTyxFQUFFLElBQUksZUFBTyxDQUFDLGtCQUFrQixDQUFDLEVBQUMsQ0FBQztTQUNoRixFQUNELENBQUMsS0FBSyxFQUFFLEVBQUMsZ0JBQWdCLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBQyxFQUFFLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLEdBQUcsRUFBRSxZQUFZLENBQUMsR0FBRyxDQUFDLENBQ25JO1FBRUQsSUFBSSxpQkFBTyxDQUF3RDs7Ozs7T0FLaEUsRUFDRCxhQUFhLEVBQ2I7WUFDRSxJQUFJLGFBQUcsQ0FBQyxrQkFBa0IsRUFBRSxvQ0FBbUIsRUFBRSxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUMsQ0FBQztZQUNsRSxJQUFJLGFBQUcsQ0FBQyxRQUFRLEVBQUUseUJBQWEsQ0FBQztTQUNqQyxFQUNELENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFDLGdCQUFnQixFQUFFLE1BQU0sRUFBQyxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLENBQUMsQ0FDaEc7S0FDRixDQUFDO0FBQ0osQ0FBQztBQTVDRCw0REE0Q0M7QUFFTSxLQUFLLFVBQVUsNEJBQTRCLENBQUMsS0FBWSxFQUFFLEtBQVksRUFBRSxJQUFtQjtJQUNoRyxPQUFPLE1BQU0sNkJBQW1CLENBQU0sa0JBQWtCLEVBQUUsd0JBQXdCLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzVHLENBQUM7QUFGRCxvRUFFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RXZlbnR9IGZyb20gJy4uL0V2ZW50JztcbmltcG9ydCB7YWRkQWN0aW9uLCBXb3JsZH0gZnJvbSAnLi4vV29ybGQnO1xuaW1wb3J0IHtQcmljZU9yYWNsZVByb3h5fSBmcm9tICcuLi9Db250cmFjdC9QcmljZU9yYWNsZVByb3h5JztcbmltcG9ydCB7YnVpbGRQcmljZU9yYWNsZVByb3h5fSBmcm9tICcuLi9CdWlsZGVyL1ByaWNlT3JhY2xlUHJveHlCdWlsZGVyJztcbmltcG9ydCB7aW52b2tlfSBmcm9tICcuLi9JbnZva2F0aW9uJztcbmltcG9ydCB7XG4gIGdldEFkZHJlc3NWLFxuICBnZXRFdmVudFYsXG4gIGdldEV4cE51bWJlclYsXG4gIGdldFN0cmluZ1Zcbn0gZnJvbSAnLi4vQ29yZVZhbHVlJztcbmltcG9ydCB7XG4gIEFkZHJlc3NWLFxuICBFdmVudFYsXG4gIE51bWJlclYsXG4gIFN0cmluZ1Zcbn0gZnJvbSAnLi4vVmFsdWUnO1xuaW1wb3J0IHtBcmcsIENvbW1hbmQsIHByb2Nlc3NDb21tYW5kRXZlbnQsIFZpZXd9IGZyb20gJy4uL0NvbW1hbmQnO1xuaW1wb3J0IHtnZXRQcmljZU9yYWNsZVByb3h5fSBmcm9tICcuLi9Db250cmFjdExvb2t1cCc7XG5pbXBvcnQge3ZlcmlmeX0gZnJvbSAnLi4vVmVyaWZ5JztcbmltcG9ydCB7ZW5jb2RlZE51bWJlcn0gZnJvbSAnLi4vRW5jb2RpbmcnO1xuXG5hc3luYyBmdW5jdGlvbiBnZW5QcmljZU9yYWNsZVByb3h5KHdvcmxkOiBXb3JsZCwgZnJvbTogc3RyaW5nLCBwYXJhbXM6IEV2ZW50KTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgcHJpY2VPcmFjbGVQcm94eTtcbiAgbGV0IGludm9rYXRpb247XG5cbiAgKHt3b3JsZCwgcHJpY2VPcmFjbGVQcm94eSwgaW52b2thdGlvbn0gPSBhd2FpdCBidWlsZFByaWNlT3JhY2xlUHJveHkod29ybGQsIGZyb20sIHBhcmFtcykpO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBEZXBsb3llZCBQcmljZU9yYWNsZVByb3h5IHRvIGFkZHJlc3MgJHtwcmljZU9yYWNsZVByb3h5Ll9hZGRyZXNzfWAsXG4gICAgaW52b2thdGlvblxuICApO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UHJpY2VPcmFjbGVQcm94eSh3b3JsZDogV29ybGQsIHByaWNlT3JhY2xlUHJveHk6IFByaWNlT3JhY2xlUHJveHksIGFwaUtleTogc3RyaW5nLCBjb250cmFjdE5hbWU6IHN0cmluZyk6IFByb21pc2U8V29ybGQ+IHtcbiAgaWYgKHdvcmxkLmlzTG9jYWxOZXR3b3JrKCkpIHtcbiAgICB3b3JsZC5wcmludGVyLnByaW50TGluZShgUG9saXRlbHkgZGVjbGluaW5nIHRvIHZlcmlmeSBvbiBsb2NhbCBuZXR3b3JrOiAke3dvcmxkLm5ldHdvcmt9LmApO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHZlcmlmeSh3b3JsZCwgYXBpS2V5LCBcIlByaWNlT3JhY2xlUHJveHlcIiwgY29udHJhY3ROYW1lLCBwcmljZU9yYWNsZVByb3h5Ll9hZGRyZXNzKTtcbiAgfVxuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0U2FpUHJpY2Uod29ybGQ6IFdvcmxkLCBmcm9tOiBzdHJpbmcsIHByaWNlT3JhY2xlUHJveHk6IFByaWNlT3JhY2xlUHJveHksIGFtb3VudDogTnVtYmVyVik6IFByb21pc2U8V29ybGQ+IHtcbiAgcmV0dXJuIGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgU2V0IHByaWNlIG9yYWNsZSBTQUkgcHJpY2UgdG8gJHthbW91bnQuc2hvdygpfWAsXG4gICAgYXdhaXQgaW52b2tlKHdvcmxkLCBwcmljZU9yYWNsZVByb3h5Lm1ldGhvZHMuc2V0U2FpUHJpY2UoYW1vdW50LmVuY29kZSgpKSwgZnJvbSlcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByaWNlT3JhY2xlUHJveHlDb21tYW5kcygpIHtcbiAgcmV0dXJuIFtcbiAgICBuZXcgQ29tbWFuZDx7cGFyYW1zOiBFdmVudFZ9PihgXG4gICAgICAgICMjIyMgRGVwbG95XG5cbiAgICAgICAgKiBcIkRlcGxveSAuLi5wYXJhbXNcIiAtIEdlbmVyYXRlcyBhIG5ldyBwcmljZSBvcmFjbGUgcHJveHlcbiAgICAgICAgICAqIEUuZy4gXCJQcmljZU9yYWNsZVByb3h5IERlcGxveSAoVW5pdHJvbGxlciBBZGRyZXNzKSAoUHJpY2VPcmFjbGUgQWRkcmVzcykgKGNFdGhlciBBZGRyZXNzKVwiXG4gICAgICBgLFxuICAgICAgXCJEZXBsb3lcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcInBhcmFtc1wiLCBnZXRFdmVudFYsIHt2YXJpYWRpYzogdHJ1ZX0pXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7cGFyYW1zfSkgPT4gZ2VuUHJpY2VPcmFjbGVQcm94eSh3b3JsZCwgZnJvbSwgcGFyYW1zLnZhbClcbiAgICApLFxuXG4gICAgbmV3IFZpZXc8e3ByaWNlT3JhY2xlUHJveHk6IFByaWNlT3JhY2xlUHJveHksIGFwaUtleTogU3RyaW5nViwgY29udHJhY3ROYW1lOiBTdHJpbmdWfT4oYFxuICAgICAgICAjIyMjIFZlcmlmeVxuXG4gICAgICAgICogXCJWZXJpZnkgYXBpS2V5OjxTdHJpbmc+IGNvbnRyYWN0TmFtZTo8U3RyaW5nPj1QcmljZU9yYWNsZVByb3h5XCIgLSBWZXJpZmllcyBQcmljZU9yYWNsZVByb3h5IGluIEV0aGVyc2NhblxuICAgICAgICAgICogRS5nLiBcIlByaWNlT3JhY2xlUHJveHkgVmVyaWZ5IFwibXlBcGlLZXlcIlxuICAgICAgYCxcbiAgICAgIFwiVmVyaWZ5XCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJwcmljZU9yYWNsZVByb3h5XCIsIGdldFByaWNlT3JhY2xlUHJveHksIHtpbXBsaWNpdDogdHJ1ZX0pLFxuICAgICAgICBuZXcgQXJnKFwiYXBpS2V5XCIsIGdldFN0cmluZ1YpLFxuICAgICAgICBuZXcgQXJnKFwiY29udHJhY3ROYW1lXCIsIGdldFN0cmluZ1YsIHtkZWZhdWx0OiBuZXcgU3RyaW5nVihcIlByaWNlT3JhY2xlUHJveHlcIil9KVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwge3ByaWNlT3JhY2xlUHJveHksIGFwaUtleSwgY29udHJhY3ROYW1lfSkgPT4gdmVyaWZ5UHJpY2VPcmFjbGVQcm94eSh3b3JsZCwgcHJpY2VPcmFjbGVQcm94eSwgYXBpS2V5LnZhbCwgY29udHJhY3ROYW1lLnZhbClcbiAgICApLFxuXG4gICAgbmV3IENvbW1hbmQ8e3ByaWNlT3JhY2xlUHJveHk6IFByaWNlT3JhY2xlUHJveHksIGFtb3VudDogTnVtYmVyVn0+KGBcbiAgICAgICAgIyMjIyBTZXRTYWlQcmljZVxuXG4gICAgICAgICogXCJTZXRTYWlQcmljZSA8QW1vdW50PlwiIC0gU2V0cyB0aGUgcGVyLWV0aGVyIHByaWNlIGZvciBTQUlcbiAgICAgICAgICAqIEUuZy4gXCJQcmljZU9yYWNsZVByb3h5IFNldFNhaVByaWNlIDEuMFwiXG4gICAgICBgLFxuICAgICAgXCJTZXRTYWlQcmljZVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwicHJpY2VPcmFjbGVQcm94eVwiLCBnZXRQcmljZU9yYWNsZVByb3h5LCB7aW1wbGljaXQ6IHRydWV9KSxcbiAgICAgICAgbmV3IEFyZyhcImFtb3VudFwiLCBnZXRFeHBOdW1iZXJWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgZnJvbSwge3ByaWNlT3JhY2xlUHJveHksIGFtb3VudH0pID0+IHNldFNhaVByaWNlKHdvcmxkLCBmcm9tLCBwcmljZU9yYWNsZVByb3h5LCBhbW91bnQpXG4gICAgKVxuICBdO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1ByaWNlT3JhY2xlUHJveHlFdmVudCh3b3JsZDogV29ybGQsIGV2ZW50OiBFdmVudCwgZnJvbTogc3RyaW5nIHwgbnVsbCk6IFByb21pc2U8V29ybGQ+IHtcbiAgcmV0dXJuIGF3YWl0IHByb2Nlc3NDb21tYW5kRXZlbnQ8YW55PihcIlByaWNlT3JhY2xlUHJveHlcIiwgcHJpY2VPcmFjbGVQcm94eUNvbW1hbmRzKCksIHdvcmxkLCBldmVudCwgZnJvbSk7XG59XG4iXX0=
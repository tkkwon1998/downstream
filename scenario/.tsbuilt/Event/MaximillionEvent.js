"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.processMaximillionEvent = exports.maximillionCommands = void 0;
const World_1 = require("../World");
const Invokation_1 = require("../Invokation");
const CoreValue_1 = require("../CoreValue");
const Value_1 = require("../Value");
const Command_1 = require("../Command");
const MaximillionBuilder_1 = require("../Builder/MaximillionBuilder");
const ContractLookup_1 = require("../ContractLookup");
const Verify_1 = require("../Verify");
function showTrxValue(world) {
    return new Value_1.NumberV(world.trxInvokationOpts.get('value')).show();
}
async function genMaximillion(world, from, params) {
    let { world: nextWorld, maximillion, maximillionData } = await MaximillionBuilder_1.buildMaximillion(world, from, params);
    world = nextWorld;
    world = World_1.addAction(world, `Added Maximillion (${maximillionData.description}) at address ${maximillion._address}`, maximillionData.invokation);
    return world;
}
async function verifyMaximillion(world, maximillion, apiKey) {
    if (world.isLocalNetwork()) {
        world.printer.printLine(`Politely declining to verify on local network: ${world.network}.`);
    }
    else {
        await Verify_1.verify(world, apiKey, "Maximillion", "Maximillion", maximillion._address);
    }
    return world;
}
async function repayBehalf(world, from, maximillion, behalf) {
    let showAmount = showTrxValue(world);
    let invokation = await Invokation_1.invoke(world, maximillion.methods.repayBehalf(behalf), from);
    world = World_1.addAction(world, `Maximillion: ${World_1.describeUser(world, from)} repays ${showAmount} of borrow on behalf of ${World_1.describeUser(world, behalf)}`, invokation);
    return world;
}
function maximillionCommands() {
    return [
        new Command_1.Command(`
        #### Deploy

        * "Maximillion Deploy ...maximillionParams" - Generates a new Maximillion
          * E.g. "Maximillion Deploy"
      `, "Deploy", [new Command_1.Arg("maximillionParams", CoreValue_1.getEventV, { variadic: true })], (world, from, { maximillionParams }) => genMaximillion(world, from, maximillionParams.val)),
        new Command_1.View(`
        #### Verify

        * "Maximillion Verify apiKey:<String>" - Verifies Maximillion in Etherscan
          * E.g. "Maximillion Verify "myApiKey"
      `, "Verify", [
            new Command_1.Arg("maximillion", ContractLookup_1.getMaximillion, { implicit: true }),
            new Command_1.Arg("apiKey", CoreValue_1.getStringV)
        ], (world, { maximillion, apiKey }) => verifyMaximillion(world, maximillion, apiKey.val)),
        new Command_1.Command(`
        #### RepayBehalf

        * "RepayBehalf behalf:<User>" - Repays up to given value of given user's borrow
          * E.g. "(Trx Value 1.0e18 (Maximillion RepayBehalf Geoff))"
      `, "RepayBehalf", [
            new Command_1.Arg("maximillion", ContractLookup_1.getMaximillion, { implicit: true }),
            new Command_1.Arg("behalf", CoreValue_1.getAddressV)
        ], (world, from, { maximillion, behalf }) => repayBehalf(world, from, maximillion, behalf.val))
    ];
}
exports.maximillionCommands = maximillionCommands;
async function processMaximillionEvent(world, event, from) {
    return await Command_1.processCommandEvent("Maximillion", maximillionCommands(), world, event, from);
}
exports.processMaximillionEvent = processMaximillionEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWF4aW1pbGxpb25FdmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9FdmVudC9NYXhpbWlsbGlvbkV2ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLG9DQUF3RDtBQUV4RCw4Q0FBcUM7QUFDckMsNENBSXNCO0FBQ3RCLG9DQUtrQjtBQUNsQix3Q0FBbUU7QUFDbkUsc0VBQStEO0FBQy9ELHNEQUFpRDtBQUNqRCxzQ0FBaUM7QUFFakMsU0FBUyxZQUFZLENBQUMsS0FBWTtJQUNoQyxPQUFPLElBQUksZUFBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNsRSxDQUFDO0FBRUQsS0FBSyxVQUFVLGNBQWMsQ0FBQyxLQUFZLEVBQUUsSUFBWSxFQUFFLE1BQWE7SUFDckUsSUFBSSxFQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBQyxHQUFHLE1BQU0scUNBQWdCLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNuRyxLQUFLLEdBQUcsU0FBUyxDQUFDO0lBRWxCLEtBQUssR0FBRyxpQkFBUyxDQUNmLEtBQUssRUFDTCxzQkFBc0IsZUFBZSxDQUFDLFdBQVcsZ0JBQWdCLFdBQVcsQ0FBQyxRQUFRLEVBQUUsRUFDdkYsZUFBZSxDQUFDLFVBQVUsQ0FDM0IsQ0FBQztJQUVGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxLQUFZLEVBQUUsV0FBd0IsRUFBRSxNQUFjO0lBQ3JGLElBQUksS0FBSyxDQUFDLGNBQWMsRUFBRSxFQUFFO1FBQzFCLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGtEQUFrRCxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztLQUM3RjtTQUFNO1FBQ0wsTUFBTSxlQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsYUFBYSxFQUFFLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUNqRjtJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELEtBQUssVUFBVSxXQUFXLENBQUMsS0FBWSxFQUFFLElBQVksRUFBRSxXQUF3QixFQUFFLE1BQWM7SUFDN0YsSUFBSSxVQUFVLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLElBQUksVUFBVSxHQUFHLE1BQU0sbUJBQU0sQ0FBQyxLQUFLLEVBQUUsV0FBVyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFcEYsS0FBSyxHQUFHLGlCQUFTLENBQ2YsS0FBSyxFQUNMLGdCQUFnQixvQkFBWSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsV0FBVyxVQUFVLDJCQUEyQixvQkFBWSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsRUFBRSxFQUN0SCxVQUFVLENBQ1gsQ0FBQztJQUVGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELFNBQWdCLG1CQUFtQjtJQUNqQyxPQUFPO1FBQ0wsSUFBSSxpQkFBTyxDQUE4Qjs7Ozs7T0FLdEMsRUFDRCxRQUFRLEVBQ1IsQ0FBQyxJQUFJLGFBQUcsQ0FBQyxtQkFBbUIsRUFBRSxxQkFBUyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUMsRUFDM0QsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUMsaUJBQWlCLEVBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQ3pGO1FBQ0QsSUFBSSxjQUFJLENBQThDOzs7OztPQUtuRCxFQUNELFFBQVEsRUFDUjtZQUNFLElBQUksYUFBRyxDQUFDLGFBQWEsRUFBRSwrQkFBYyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxDQUFDO1lBQ3hELElBQUksYUFBRyxDQUFDLFFBQVEsRUFBRSxzQkFBVSxDQUFDO1NBQzlCLEVBQ0QsQ0FBQyxLQUFLLEVBQUUsRUFBQyxXQUFXLEVBQUUsTUFBTSxFQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUNwRjtRQUNELElBQUksaUJBQU8sQ0FBK0M7Ozs7O09BS3ZELEVBQ0QsYUFBYSxFQUNiO1lBQ0UsSUFBSSxhQUFHLENBQUMsYUFBYSxFQUFFLCtCQUFjLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUM7WUFDeEQsSUFBSSxhQUFHLENBQUMsUUFBUSxFQUFFLHVCQUFXLENBQUM7U0FDL0IsRUFDRCxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBQyxXQUFXLEVBQUUsTUFBTSxFQUFDLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQzFGO0tBQ0YsQ0FBQztBQUNKLENBQUM7QUF2Q0Qsa0RBdUNDO0FBRU0sS0FBSyxVQUFVLHVCQUF1QixDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsSUFBbUI7SUFDM0YsT0FBTyxNQUFNLDZCQUFtQixDQUFNLGFBQWEsRUFBRSxtQkFBbUIsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDbEcsQ0FBQztBQUZELDBEQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFdmVudH0gZnJvbSAnLi4vRXZlbnQnO1xuaW1wb3J0IHthZGRBY3Rpb24sIGRlc2NyaWJlVXNlciwgV29ybGR9IGZyb20gJy4uL1dvcmxkJztcbmltcG9ydCB7TWF4aW1pbGxpb259IGZyb20gJy4uL0NvbnRyYWN0L01heGltaWxsaW9uJztcbmltcG9ydCB7aW52b2tlfSBmcm9tICcuLi9JbnZva2F0aW9uJztcbmltcG9ydCB7XG4gIGdldEFkZHJlc3NWLFxuICBnZXRFdmVudFYsXG4gIGdldFN0cmluZ1Zcbn0gZnJvbSAnLi4vQ29yZVZhbHVlJztcbmltcG9ydCB7XG4gIEFkZHJlc3NWLFxuICBFdmVudFYsXG4gIE51bWJlclYsXG4gIFN0cmluZ1Zcbn0gZnJvbSAnLi4vVmFsdWUnO1xuaW1wb3J0IHtBcmcsIENvbW1hbmQsIFZpZXcsIHByb2Nlc3NDb21tYW5kRXZlbnR9IGZyb20gJy4uL0NvbW1hbmQnO1xuaW1wb3J0IHtidWlsZE1heGltaWxsaW9ufSBmcm9tICcuLi9CdWlsZGVyL01heGltaWxsaW9uQnVpbGRlcic7XG5pbXBvcnQge2dldE1heGltaWxsaW9ufSBmcm9tICcuLi9Db250cmFjdExvb2t1cCc7XG5pbXBvcnQge3ZlcmlmeX0gZnJvbSAnLi4vVmVyaWZ5JztcblxuZnVuY3Rpb24gc2hvd1RyeFZhbHVlKHdvcmxkOiBXb3JsZCk6IHN0cmluZyB7XG4gIHJldHVybiBuZXcgTnVtYmVyVih3b3JsZC50cnhJbnZva2F0aW9uT3B0cy5nZXQoJ3ZhbHVlJykpLnNob3coKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuTWF4aW1pbGxpb24od29ybGQ6IFdvcmxkLCBmcm9tOiBzdHJpbmcsIHBhcmFtczogRXZlbnQpOiBQcm9taXNlPFdvcmxkPiB7XG4gIGxldCB7d29ybGQ6IG5leHRXb3JsZCwgbWF4aW1pbGxpb24sIG1heGltaWxsaW9uRGF0YX0gPSBhd2FpdCBidWlsZE1heGltaWxsaW9uKHdvcmxkLCBmcm9tLCBwYXJhbXMpO1xuICB3b3JsZCA9IG5leHRXb3JsZDtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgQWRkZWQgTWF4aW1pbGxpb24gKCR7bWF4aW1pbGxpb25EYXRhLmRlc2NyaXB0aW9ufSkgYXQgYWRkcmVzcyAke21heGltaWxsaW9uLl9hZGRyZXNzfWAsXG4gICAgbWF4aW1pbGxpb25EYXRhLmludm9rYXRpb25cbiAgKTtcblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHZlcmlmeU1heGltaWxsaW9uKHdvcmxkOiBXb3JsZCwgbWF4aW1pbGxpb246IE1heGltaWxsaW9uLCBhcGlLZXk6IHN0cmluZyk6IFByb21pc2U8V29ybGQ+IHtcbiAgaWYgKHdvcmxkLmlzTG9jYWxOZXR3b3JrKCkpIHtcbiAgICB3b3JsZC5wcmludGVyLnByaW50TGluZShgUG9saXRlbHkgZGVjbGluaW5nIHRvIHZlcmlmeSBvbiBsb2NhbCBuZXR3b3JrOiAke3dvcmxkLm5ldHdvcmt9LmApO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHZlcmlmeSh3b3JsZCwgYXBpS2V5LCBcIk1heGltaWxsaW9uXCIsIFwiTWF4aW1pbGxpb25cIiwgbWF4aW1pbGxpb24uX2FkZHJlc3MpO1xuICB9XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZXBheUJlaGFsZih3b3JsZDogV29ybGQsIGZyb206IHN0cmluZywgbWF4aW1pbGxpb246IE1heGltaWxsaW9uLCBiZWhhbGY6IHN0cmluZyk6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IHNob3dBbW91bnQgPSBzaG93VHJ4VmFsdWUod29ybGQpO1xuICBsZXQgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZSh3b3JsZCwgbWF4aW1pbGxpb24ubWV0aG9kcy5yZXBheUJlaGFsZihiZWhhbGYpLCBmcm9tKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgTWF4aW1pbGxpb246ICR7ZGVzY3JpYmVVc2VyKHdvcmxkLCBmcm9tKX0gcmVwYXlzICR7c2hvd0Ftb3VudH0gb2YgYm9ycm93IG9uIGJlaGFsZiBvZiAke2Rlc2NyaWJlVXNlcih3b3JsZCwgYmVoYWxmKX1gLFxuICAgIGludm9rYXRpb25cbiAgKTtcblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXhpbWlsbGlvbkNvbW1hbmRzKCkge1xuICByZXR1cm4gW1xuICAgIG5ldyBDb21tYW5kPHttYXhpbWlsbGlvblBhcmFtczogRXZlbnRWfT4oYFxuICAgICAgICAjIyMjIERlcGxveVxuXG4gICAgICAgICogXCJNYXhpbWlsbGlvbiBEZXBsb3kgLi4ubWF4aW1pbGxpb25QYXJhbXNcIiAtIEdlbmVyYXRlcyBhIG5ldyBNYXhpbWlsbGlvblxuICAgICAgICAgICogRS5nLiBcIk1heGltaWxsaW9uIERlcGxveVwiXG4gICAgICBgLFxuICAgICAgXCJEZXBsb3lcIixcbiAgICAgIFtuZXcgQXJnKFwibWF4aW1pbGxpb25QYXJhbXNcIiwgZ2V0RXZlbnRWLCB7dmFyaWFkaWM6IHRydWV9KV0sXG4gICAgICAod29ybGQsIGZyb20sIHttYXhpbWlsbGlvblBhcmFtc30pID0+IGdlbk1heGltaWxsaW9uKHdvcmxkLCBmcm9tLCBtYXhpbWlsbGlvblBhcmFtcy52YWwpXG4gICAgKSxcbiAgICBuZXcgVmlldzx7bWF4aW1pbGxpb246IE1heGltaWxsaW9uLCBhcGlLZXk6IFN0cmluZ1Z9PihgXG4gICAgICAgICMjIyMgVmVyaWZ5XG5cbiAgICAgICAgKiBcIk1heGltaWxsaW9uIFZlcmlmeSBhcGlLZXk6PFN0cmluZz5cIiAtIFZlcmlmaWVzIE1heGltaWxsaW9uIGluIEV0aGVyc2NhblxuICAgICAgICAgICogRS5nLiBcIk1heGltaWxsaW9uIFZlcmlmeSBcIm15QXBpS2V5XCJcbiAgICAgIGAsXG4gICAgICBcIlZlcmlmeVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwibWF4aW1pbGxpb25cIiwgZ2V0TWF4aW1pbGxpb24sIHtpbXBsaWNpdDogdHJ1ZX0pLFxuICAgICAgICBuZXcgQXJnKFwiYXBpS2V5XCIsIGdldFN0cmluZ1YpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7bWF4aW1pbGxpb24sIGFwaUtleX0pID0+IHZlcmlmeU1heGltaWxsaW9uKHdvcmxkLCBtYXhpbWlsbGlvbiwgYXBpS2V5LnZhbClcbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHttYXhpbWlsbGlvbjogTWF4aW1pbGxpb24sIGJlaGFsZjogQWRkcmVzc1Z9PihgXG4gICAgICAgICMjIyMgUmVwYXlCZWhhbGZcblxuICAgICAgICAqIFwiUmVwYXlCZWhhbGYgYmVoYWxmOjxVc2VyPlwiIC0gUmVwYXlzIHVwIHRvIGdpdmVuIHZhbHVlIG9mIGdpdmVuIHVzZXIncyBib3Jyb3dcbiAgICAgICAgICAqIEUuZy4gXCIoVHJ4IFZhbHVlIDEuMGUxOCAoTWF4aW1pbGxpb24gUmVwYXlCZWhhbGYgR2VvZmYpKVwiXG4gICAgICBgLFxuICAgICAgXCJSZXBheUJlaGFsZlwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwibWF4aW1pbGxpb25cIiwgZ2V0TWF4aW1pbGxpb24sIHtpbXBsaWNpdDogdHJ1ZX0pLFxuICAgICAgICBuZXcgQXJnKFwiYmVoYWxmXCIsIGdldEFkZHJlc3NWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgZnJvbSwge21heGltaWxsaW9uLCBiZWhhbGZ9KSA9PiByZXBheUJlaGFsZih3b3JsZCwgZnJvbSwgbWF4aW1pbGxpb24sIGJlaGFsZi52YWwpXG4gICAgKVxuICBdO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc01heGltaWxsaW9uRXZlbnQod29ybGQ6IFdvcmxkLCBldmVudDogRXZlbnQsIGZyb206IHN0cmluZyB8IG51bGwpOiBQcm9taXNlPFdvcmxkPiB7XG4gIHJldHVybiBhd2FpdCBwcm9jZXNzQ29tbWFuZEV2ZW50PGFueT4oXCJNYXhpbWlsbGlvblwiLCBtYXhpbWlsbGlvbkNvbW1hbmRzKCksIHdvcmxkLCBldmVudCwgZnJvbSk7XG59XG4iXX0=
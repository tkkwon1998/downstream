"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getErc20Value = exports.erc20Fetchers = exports.getErc20V = exports.getErc20Decimals = exports.getErc20Symbol = exports.getErc20Name = void 0;
const ContractLookup_1 = require("../ContractLookup");
const CoreValue_1 = require("../CoreValue");
const Command_1 = require("../Command");
const Value_1 = require("../Value");
async function getErc20Name(world, erc20) {
    return new Value_1.StringV(await erc20.methods.name().call());
}
exports.getErc20Name = getErc20Name;
async function getErc20Symbol(world, erc20) {
    return new Value_1.StringV(await erc20.methods.symbol().call());
}
exports.getErc20Symbol = getErc20Symbol;
async function getErc20Decimals(world, erc20) {
    return new Value_1.NumberV(await erc20.methods.decimals().call());
}
exports.getErc20Decimals = getErc20Decimals;
async function getTotalSupply(world, erc20) {
    return new Value_1.NumberV(await erc20.methods.totalSupply().call());
}
async function getTokenBalance(world, erc20, address) {
    return new Value_1.NumberV(await erc20.methods.balanceOf(address).call());
}
async function getAllowance(world, erc20, owner, spender) {
    return new Value_1.NumberV(await erc20.methods.allowance(owner, spender).call());
}
async function getErc20V(world, event) {
    const address = await CoreValue_1.mapValue(world, event, (str) => new Value_1.AddressV(ContractLookup_1.getErc20Address(world, str)), CoreValue_1.getCoreValue, Value_1.AddressV);
    return ContractLookup_1.getWorldContractByAddress(world, address.val);
}
exports.getErc20V = getErc20V;
function erc20Fetchers() {
    return [
        new Command_1.Fetcher(`
        #### Address

        * "Erc20 <Erc20> Address" - Returns address of ERC-20 contract
          * E.g. "Erc20 ZRX Address" - Returns ZRX's address
      `, "Address", [
            new Command_1.Arg("erc20", getErc20V)
        ], async (world, { erc20 }) => new Value_1.AddressV(erc20._address), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Name

        * "Erc20 <Erc20> Name" - Returns name of ERC-20 contract
          * E.g. "Erc20 ZRX Name" - Returns ZRX's name
      `, "Name", [
            new Command_1.Arg("erc20", getErc20V)
        ], (world, { erc20 }) => getErc20Name(world, erc20), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Symbol

        * "Erc20 <Erc20> Symbol" - Returns symbol of ERC-20 contract
          * E.g. "Erc20 ZRX Symbol" - Returns ZRX's symbol
      `, "Symbol", [
            new Command_1.Arg("erc20", getErc20V)
        ], (world, { erc20 }) => getErc20Symbol(world, erc20), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Decimals

        * "Erc20 <Erc20> Decimals" - Returns number of decimals in ERC-20 contract
          * E.g. "Erc20 ZRX Decimals" - Returns ZRX's decimals
      `, "Decimals", [
            new Command_1.Arg("erc20", getErc20V)
        ], (world, { erc20 }) => getErc20Decimals(world, erc20), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### TotalSupply

        * "Erc20 <Erc20> TotalSupply" - Returns the ERC-20 token's total supply
          * E.g. "Erc20 ZRX TotalSupply"
          * E.g. "Erc20 cZRX TotalSupply"
      `, "TotalSupply", [
            new Command_1.Arg("erc20", getErc20V)
        ], (world, { erc20 }) => getTotalSupply(world, erc20), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### TokenBalance

        * "Erc20 <Erc20> TokenBalance <Address>" - Returns the ERC-20 token balance of a given address
          * E.g. "Erc20 ZRX TokenBalance Geoff" - Returns a user's ZRX balance
          * E.g. "Erc20 cZRX TokenBalance Geoff" - Returns a user's cZRX balance
          * E.g. "Erc20 ZRX TokenBalance cZRX" - Returns cZRX's ZRX balance
      `, "TokenBalance", [
            new Command_1.Arg("erc20", getErc20V),
            new Command_1.Arg("address", CoreValue_1.getAddressV)
        ], (world, { erc20, address }) => getTokenBalance(world, erc20, address.val), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Allowance

        * "Erc20 <Erc20> Allowance owner:<Address> spender:<Address>" - Returns the ERC-20 allowance from owner to spender
          * E.g. "Erc20 ZRX Allowance Geoff Torrey" - Returns the ZRX allowance of Geoff to Torrey
          * E.g. "Erc20 cZRX Allowance Geoff Coburn" - Returns the cZRX allowance of Geoff to Coburn
          * E.g. "Erc20 ZRX Allowance Geoff cZRX" - Returns the ZRX allowance of Geoff to the cZRX cToken
      `, "Allowance", [
            new Command_1.Arg("erc20", getErc20V),
            new Command_1.Arg("owner", CoreValue_1.getAddressV),
            new Command_1.Arg("spender", CoreValue_1.getAddressV)
        ], (world, { erc20, owner, spender }) => getAllowance(world, erc20, owner.val, spender.val), { namePos: 1 })
    ];
}
exports.erc20Fetchers = erc20Fetchers;
async function getErc20Value(world, event) {
    return await Command_1.getFetcherValue("Erc20", erc20Fetchers(), world, event);
}
exports.getErc20Value = getErc20Value;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXJjMjBWYWx1ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9WYWx1ZS9FcmMyMFZhbHVlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUdBLHNEQUE2RTtBQUM3RSw0Q0FJc0I7QUFDdEIsd0NBQXlEO0FBQ3pELG9DQUtrQjtBQUVYLEtBQUssVUFBVSxZQUFZLENBQUMsS0FBWSxFQUFFLEtBQVk7SUFDM0QsT0FBTyxJQUFJLGVBQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUN4RCxDQUFDO0FBRkQsb0NBRUM7QUFFTSxLQUFLLFVBQVUsY0FBYyxDQUFDLEtBQVksRUFBRSxLQUFZO0lBQzdELE9BQU8sSUFBSSxlQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFDMUQsQ0FBQztBQUZELHdDQUVDO0FBRU0sS0FBSyxVQUFVLGdCQUFnQixDQUFDLEtBQVksRUFBRSxLQUFZO0lBQy9ELE9BQU8sSUFBSSxlQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFDNUQsQ0FBQztBQUZELDRDQUVDO0FBRUQsS0FBSyxVQUFVLGNBQWMsQ0FBQyxLQUFZLEVBQUUsS0FBWTtJQUN0RCxPQUFPLElBQUksZUFBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFFRCxLQUFLLFVBQVUsZUFBZSxDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsT0FBZTtJQUN4RSxPQUFPLElBQUksZUFBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FB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R0FBRyxDQUFDLEVBQ3ZFLEVBQUMsT0FBTyxFQUFFLENBQUMsRUFBQyxDQUNiO1FBQ0QsSUFBSSxpQkFBTyxDQUE4RDs7Ozs7OztPQU90RSxFQUNELFdBQVcsRUFDWDtZQUNFLElBQUksYUFBRyxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUM7WUFDM0IsSUFBSSxhQUFHLENBQUMsT0FBTyxFQUFFLHVCQUFXLENBQUM7WUFDN0IsSUFBSSxhQUFHLENBQUMsU0FBUyxFQUFFLHVCQUFXLENBQUM7U0FDaEMsRUFDRCxDQUFDLEtBQUssRUFBRSxFQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUN0RixFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUMsQ0FDYjtLQUNGLENBQUM7QUFDSixDQUFDO0FBdEdELHNDQXNHQztBQUVNLEtBQUssVUFBVSxhQUFhLENBQUMsS0FBWSxFQUFFLEtBQVk7SUFDNUQsT0FBTyxNQUFNLHlCQUFlLENBQVcsT0FBTyxFQUFFLGFBQWEsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNqRixDQUFDO0FBRkQsc0NBRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0V2ZW50fSBmcm9tICcuLi9FdmVudCc7XG5pbXBvcnQge1dvcmxkfSBmcm9tICcuLi9Xb3JsZCc7XG5pbXBvcnQge0VyYzIwfSBmcm9tICcuLi9Db250cmFjdC9FcmMyMCc7XG5pbXBvcnQge2dldEVyYzIwQWRkcmVzcywgZ2V0V29ybGRDb250cmFjdEJ5QWRkcmVzc30gZnJvbSAnLi4vQ29udHJhY3RMb29rdXAnO1xuaW1wb3J0IHtcbiAgZ2V0QWRkcmVzc1YsXG4gIGdldENvcmVWYWx1ZSxcbiAgbWFwVmFsdWUsXG59IGZyb20gJy4uL0NvcmVWYWx1ZSc7XG5pbXBvcnQge0FyZywgRmV0Y2hlciwgZ2V0RmV0Y2hlclZhbHVlfSBmcm9tICcuLi9Db21tYW5kJztcbmltcG9ydCB7XG4gIEFkZHJlc3NWLFxuICBOdW1iZXJWLFxuICBWYWx1ZSxcbiAgU3RyaW5nVlxufSBmcm9tICcuLi9WYWx1ZSc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRFcmMyME5hbWUod29ybGQ6IFdvcmxkLCBlcmMyMDogRXJjMjApOiBQcm9taXNlPFN0cmluZ1Y+IHtcbiAgcmV0dXJuIG5ldyBTdHJpbmdWKGF3YWl0IGVyYzIwLm1ldGhvZHMubmFtZSgpLmNhbGwoKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRFcmMyMFN5bWJvbCh3b3JsZDogV29ybGQsIGVyYzIwOiBFcmMyMCk6IFByb21pc2U8U3RyaW5nVj4ge1xuICByZXR1cm4gbmV3IFN0cmluZ1YoYXdhaXQgZXJjMjAubWV0aG9kcy5zeW1ib2woKS5jYWxsKCkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RXJjMjBEZWNpbWFscyh3b3JsZDogV29ybGQsIGVyYzIwOiBFcmMyMCk6IFByb21pc2U8TnVtYmVyVj4ge1xuICByZXR1cm4gbmV3IE51bWJlclYoYXdhaXQgZXJjMjAubWV0aG9kcy5kZWNpbWFscygpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFRvdGFsU3VwcGx5KHdvcmxkOiBXb3JsZCwgZXJjMjA6IEVyYzIwKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBlcmMyMC5tZXRob2RzLnRvdGFsU3VwcGx5KCkuY2FsbCgpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0VG9rZW5CYWxhbmNlKHdvcmxkOiBXb3JsZCwgZXJjMjA6IEVyYzIwLCBhZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPE51bWJlclY+IHtcbiAgcmV0dXJuIG5ldyBOdW1iZXJWKGF3YWl0IGVyYzIwLm1ldGhvZHMuYmFsYW5jZU9mKGFkZHJlc3MpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFsbG93YW5jZSh3b3JsZDogV29ybGQsIGVyYzIwOiBFcmMyMCwgb3duZXI6IHN0cmluZywgc3BlbmRlcjogc3RyaW5nKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBlcmMyMC5tZXRob2RzLmFsbG93YW5jZShvd25lciwgc3BlbmRlcikuY2FsbCgpKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEVyYzIwVih3b3JsZDogV29ybGQsIGV2ZW50OiBFdmVudCk6IFByb21pc2U8RXJjMjA+IHtcbiAgY29uc3QgYWRkcmVzcyA9IGF3YWl0IG1hcFZhbHVlPEFkZHJlc3NWPihcbiAgICB3b3JsZCxcbiAgICBldmVudCxcbiAgICAoc3RyKSA9PiBuZXcgQWRkcmVzc1YoZ2V0RXJjMjBBZGRyZXNzKHdvcmxkLCBzdHIpKSxcbiAgICBnZXRDb3JlVmFsdWUsXG4gICAgQWRkcmVzc1ZcbiAgKTtcblxuICByZXR1cm4gZ2V0V29ybGRDb250cmFjdEJ5QWRkcmVzczxFcmMyMD4od29ybGQsIGFkZHJlc3MudmFsKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVyYzIwRmV0Y2hlcnMoKSB7XG4gIHJldHVybiBbXG4gICAgbmV3IEZldGNoZXI8e2VyYzIwOiBFcmMyMH0sIEFkZHJlc3NWPihgXG4gICAgICAgICMjIyMgQWRkcmVzc1xuXG4gICAgICAgICogXCJFcmMyMCA8RXJjMjA+IEFkZHJlc3NcIiAtIFJldHVybnMgYWRkcmVzcyBvZiBFUkMtMjAgY29udHJhY3RcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBaUlggQWRkcmVzc1wiIC0gUmV0dXJucyBaUlgncyBhZGRyZXNzXG4gICAgICBgLFxuICAgICAgXCJBZGRyZXNzXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJlcmMyMFwiLCBnZXRFcmMyMFYpXG4gICAgICBdLFxuICAgICAgYXN5bmMgKHdvcmxkLCB7ZXJjMjB9KSA9PiBuZXcgQWRkcmVzc1YoZXJjMjAuX2FkZHJlc3MpLFxuICAgICAge25hbWVQb3M6IDF9XG4gICAgKSxcbiAgICBuZXcgRmV0Y2hlcjx7ZXJjMjA6IEVyYzIwfSwgU3RyaW5nVj4oYFxuICAgICAgICAjIyMjIE5hbWVcblxuICAgICAgICAqIFwiRXJjMjAgPEVyYzIwPiBOYW1lXCIgLSBSZXR1cm5zIG5hbWUgb2YgRVJDLTIwIGNvbnRyYWN0XG4gICAgICAgICAgKiBFLmcuIFwiRXJjMjAgWlJYIE5hbWVcIiAtIFJldHVybnMgWlJYJ3MgbmFtZVxuICAgICAgYCxcbiAgICAgIFwiTmFtZVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZXJjMjBcIiwgZ2V0RXJjMjBWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwge2VyYzIwfSkgPT4gZ2V0RXJjMjBOYW1lKHdvcmxkLCBlcmMyMCksXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuICAgIG5ldyBGZXRjaGVyPHtlcmMyMDogRXJjMjB9LCBTdHJpbmdWPihgXG4gICAgICAgICMjIyMgU3ltYm9sXG5cbiAgICAgICAgKiBcIkVyYzIwIDxFcmMyMD4gU3ltYm9sXCIgLSBSZXR1cm5zIHN5bWJvbCBvZiBFUkMtMjAgY29udHJhY3RcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBaUlggU3ltYm9sXCIgLSBSZXR1cm5zIFpSWCdzIHN5bWJvbFxuICAgICAgYCxcbiAgICAgIFwiU3ltYm9sXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJlcmMyMFwiLCBnZXRFcmMyMFYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7ZXJjMjB9KSA9PiBnZXRFcmMyMFN5bWJvbCh3b3JsZCwgZXJjMjApLFxuICAgICAge25hbWVQb3M6IDF9XG4gICAgKSxcbiAgICBuZXcgRmV0Y2hlcjx7ZXJjMjA6IEVyYzIwfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIERlY2ltYWxzXG5cbiAgICAgICAgKiBcIkVyYzIwIDxFcmMyMD4gRGVjaW1hbHNcIiAtIFJldHVybnMgbnVtYmVyIG9mIGRlY2ltYWxzIGluIEVSQy0yMCBjb250cmFjdFxuICAgICAgICAgICogRS5nLiBcIkVyYzIwIFpSWCBEZWNpbWFsc1wiIC0gUmV0dXJucyBaUlgncyBkZWNpbWFsc1xuICAgICAgYCxcbiAgICAgIFwiRGVjaW1hbHNcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImVyYzIwXCIsIGdldEVyYzIwVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIHtlcmMyMH0pID0+IGdldEVyYzIwRGVjaW1hbHMod29ybGQsIGVyYzIwKSxcbiAgICAgIHtuYW1lUG9zOiAxfVxuICAgICksXG4gICAgbmV3IEZldGNoZXI8e2VyYzIwOiBFcmMyMH0sIE51bWJlclY+KGBcbiAgICAgICAgIyMjIyBUb3RhbFN1cHBseVxuXG4gICAgICAgICogXCJFcmMyMCA8RXJjMjA+IFRvdGFsU3VwcGx5XCIgLSBSZXR1cm5zIHRoZSBFUkMtMjAgdG9rZW4ncyB0b3RhbCBzdXBwbHlcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBaUlggVG90YWxTdXBwbHlcIlxuICAgICAgICAgICogRS5nLiBcIkVyYzIwIGNaUlggVG90YWxTdXBwbHlcIlxuICAgICAgYCxcbiAgICAgIFwiVG90YWxTdXBwbHlcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImVyYzIwXCIsIGdldEVyYzIwVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIHtlcmMyMH0pID0+IGdldFRvdGFsU3VwcGx5KHdvcmxkLCBlcmMyMCksXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuICAgIG5ldyBGZXRjaGVyPHtlcmMyMDogRXJjMjAsIGFkZHJlc3M6IEFkZHJlc3NWfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIFRva2VuQmFsYW5jZVxuXG4gICAgICAgICogXCJFcmMyMCA8RXJjMjA+IFRva2VuQmFsYW5jZSA8QWRkcmVzcz5cIiAtIFJldHVybnMgdGhlIEVSQy0yMCB0b2tlbiBiYWxhbmNlIG9mIGEgZ2l2ZW4gYWRkcmVzc1xuICAgICAgICAgICogRS5nLiBcIkVyYzIwIFpSWCBUb2tlbkJhbGFuY2UgR2VvZmZcIiAtIFJldHVybnMgYSB1c2VyJ3MgWlJYIGJhbGFuY2VcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBjWlJYIFRva2VuQmFsYW5jZSBHZW9mZlwiIC0gUmV0dXJucyBhIHVzZXIncyBjWlJYIGJhbGFuY2VcbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBaUlggVG9rZW5CYWxhbmNlIGNaUlhcIiAtIFJldHVybnMgY1pSWCdzIFpSWCBiYWxhbmNlXG4gICAgICBgLFxuICAgICAgXCJUb2tlbkJhbGFuY2VcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImVyYzIwXCIsIGdldEVyYzIwViksXG4gICAgICAgIG5ldyBBcmcoXCJhZGRyZXNzXCIsIGdldEFkZHJlc3NWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwge2VyYzIwLCBhZGRyZXNzfSkgPT4gZ2V0VG9rZW5CYWxhbmNlKHdvcmxkLCBlcmMyMCwgYWRkcmVzcy52YWwpLFxuICAgICAge25hbWVQb3M6IDF9XG4gICAgKSxcbiAgICBuZXcgRmV0Y2hlcjx7ZXJjMjA6IEVyYzIwLCBvd25lcjogQWRkcmVzc1YsIHNwZW5kZXI6IEFkZHJlc3NWfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIEFsbG93YW5jZVxuXG4gICAgICAgICogXCJFcmMyMCA8RXJjMjA+IEFsbG93YW5jZSBvd25lcjo8QWRkcmVzcz4gc3BlbmRlcjo8QWRkcmVzcz5cIiAtIFJldHVybnMgdGhlIEVSQy0yMCBhbGxvd2FuY2UgZnJvbSBvd25lciB0byBzcGVuZGVyXG4gICAgICAgICAgKiBFLmcuIFwiRXJjMjAgWlJYIEFsbG93YW5jZSBHZW9mZiBUb3JyZXlcIiAtIFJldHVybnMgdGhlIFpSWCBhbGxvd2FuY2Ugb2YgR2VvZmYgdG8gVG9ycmV5XG4gICAgICAgICAgKiBFLmcuIFwiRXJjMjAgY1pSWCBBbGxvd2FuY2UgR2VvZmYgQ29idXJuXCIgLSBSZXR1cm5zIHRoZSBjWlJYIGFsbG93YW5jZSBvZiBHZW9mZiB0byBDb2J1cm5cbiAgICAgICAgICAqIEUuZy4gXCJFcmMyMCBaUlggQWxsb3dhbmNlIEdlb2ZmIGNaUlhcIiAtIFJldHVybnMgdGhlIFpSWCBhbGxvd2FuY2Ugb2YgR2VvZmYgdG8gdGhlIGNaUlggY1Rva2VuXG4gICAgICBgLFxuICAgICAgXCJBbGxvd2FuY2VcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImVyYzIwXCIsIGdldEVyYzIwViksXG4gICAgICAgIG5ldyBBcmcoXCJvd25lclwiLCBnZXRBZGRyZXNzViksXG4gICAgICAgIG5ldyBBcmcoXCJzcGVuZGVyXCIsIGdldEFkZHJlc3NWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwge2VyYzIwLCBvd25lciwgc3BlbmRlcn0pID0+IGdldEFsbG93YW5jZSh3b3JsZCwgZXJjMjAsIG93bmVyLnZhbCwgc3BlbmRlci52YWwpLFxuICAgICAge25hbWVQb3M6IDF9XG4gICAgKVxuICBdO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RXJjMjBWYWx1ZSh3b3JsZDogV29ybGQsIGV2ZW50OiBFdmVudCk6IFByb21pc2U8VmFsdWU+IHtcbiAgcmV0dXJuIGF3YWl0IGdldEZldGNoZXJWYWx1ZTxhbnksIGFueT4oXCJFcmMyMFwiLCBlcmMyMEZldGNoZXJzKCksIHdvcmxkLCBldmVudCk7XG59XG4iXX0=
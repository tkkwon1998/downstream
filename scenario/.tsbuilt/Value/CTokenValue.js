"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getCTokenValue = exports.cTokenFetchers = exports.getCErc20DelegatorV = exports.getCTokenV = void 0;
const CoreValue_1 = require("../CoreValue");
const Command_1 = require("../Command");
const Value_1 = require("../Value");
const ContractLookup_1 = require("../ContractLookup");
async function getCTokenV(world, event) {
    const address = await CoreValue_1.mapValue(world, event, (str) => new Value_1.AddressV(ContractLookup_1.getCTokenAddress(world, str)), CoreValue_1.getCoreValue, Value_1.AddressV);
    return ContractLookup_1.getWorldContractByAddress(world, address.val);
}
exports.getCTokenV = getCTokenV;
async function getCErc20DelegatorV(world, event) {
    const address = await CoreValue_1.mapValue(world, event, (str) => new Value_1.AddressV(ContractLookup_1.getCTokenAddress(world, str)), CoreValue_1.getCoreValue, Value_1.AddressV);
    return ContractLookup_1.getWorldContractByAddress(world, address.val);
}
exports.getCErc20DelegatorV = getCErc20DelegatorV;
async function getInterestRateModel(world, cToken) {
    return new Value_1.AddressV(await cToken.methods.interestRateModel().call());
}
async function cTokenAddress(world, cToken) {
    return new Value_1.AddressV(cToken._address);
}
async function getCTokenAdmin(world, cToken) {
    return new Value_1.AddressV(await cToken.methods.admin().call());
}
async function getCTokenPendingAdmin(world, cToken) {
    return new Value_1.AddressV(await cToken.methods.pendingAdmin().call());
}
async function balanceOfUnderlying(world, cToken, user) {
    return new Value_1.NumberV(await cToken.methods.balanceOfUnderlying(user).call());
}
async function getBorrowBalance(world, cToken, user) {
    return new Value_1.NumberV(await cToken.methods.borrowBalanceCurrent(user).call());
}
async function getBorrowBalanceStored(world, cToken, user) {
    return new Value_1.NumberV(await cToken.methods.borrowBalanceStored(user).call());
}
async function getTotalBorrows(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.totalBorrows().call());
}
async function getTotalBorrowsCurrent(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.totalBorrowsCurrent().call());
}
async function getReserveFactor(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.reserveFactorMantissa().call(), 1.0e18);
}
async function getTotalReserves(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.totalReserves().call());
}
async function getComptroller(world, cToken) {
    return new Value_1.AddressV(await cToken.methods.comptroller().call());
}
async function getExchangeRateStored(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.exchangeRateStored().call());
}
async function getExchangeRate(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.exchangeRateCurrent().call(), 1e18);
}
async function getCash(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.getCash().call());
}
async function getInterestRate(world, cToken) {
    return new Value_1.NumberV(await cToken.methods.borrowRatePerBlock().call(), 1.0e18 / 2102400);
}
async function getImplementation(world, cToken) {
    return new Value_1.AddressV(await cToken.methods.implementation().call());
}
function cTokenFetchers() {
    return [
        new Command_1.Fetcher(`
        #### Address

        * "CToken <CToken> Address" - Returns address of CToken contract
          * E.g. "CToken cZRX Address" - Returns cZRX's address
      `, "Address", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => cTokenAddress(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### InterestRateModel

        * "CToken <CToken> InterestRateModel" - Returns the interest rate model of CToken contract
          * E.g. "CToken cZRX InterestRateModel" - Returns cZRX's interest rate model
      `, "InterestRateModel", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getInterestRateModel(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Admin

        * "CToken <CToken> Admin" - Returns the admin of CToken contract
          * E.g. "CToken cZRX Admin" - Returns cZRX's admin
      `, "Admin", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getCTokenAdmin(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### PendingAdmin

        * "CToken <CToken> PendingAdmin" - Returns the pending admin of CToken contract
          * E.g. "CToken cZRX PendingAdmin" - Returns cZRX's pending admin
      `, "PendingAdmin", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getCTokenPendingAdmin(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Underlying

        * "CToken <CToken> Underlying" - Returns the underlying asset (if applicable)
          * E.g. "CToken cZRX Underlying"
      `, "Underlying", [
            new Command_1.Arg("cToken", getCTokenV)
        ], async (world, { cToken }) => new Value_1.AddressV(await cToken.methods.underlying().call()), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### UnderlyingBalance

        * "CToken <CToken> UnderlyingBalance <User>" - Returns a user's underlying balance (based on given exchange rate)
          * E.g. "CToken cZRX UnderlyingBalance Geoff"
      `, "UnderlyingBalance", [
            new Command_1.Arg("cToken", getCTokenV),
            new Command_1.Arg("address", CoreValue_1.getAddressV)
        ], (world, { cToken, address }) => balanceOfUnderlying(world, cToken, address.val), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### BorrowBalance

        * "CToken <CToken> BorrowBalance <User>" - Returns a user's borrow balance (including interest)
          * E.g. "CToken cZRX BorrowBalance Geoff"
      `, "BorrowBalance", [
            new Command_1.Arg("cToken", getCTokenV),
            new Command_1.Arg("address", CoreValue_1.getAddressV)
        ], (world, { cToken, address }) => getBorrowBalance(world, cToken, address.val), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### BorrowBalanceStored

        * "CToken <CToken> BorrowBalanceStored <User>" - Returns a user's borrow balance (without specifically re-accruing interest)
          * E.g. "CToken cZRX BorrowBalanceStored Geoff"
      `, "BorrowBalanceStored", [
            new Command_1.Arg("cToken", getCTokenV),
            new Command_1.Arg("address", CoreValue_1.getAddressV)
        ], (world, { cToken, address }) => getBorrowBalanceStored(world, cToken, address.val), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### TotalBorrows

        * "CToken <CToken> TotalBorrows" - Returns the cToken's total borrow balance
          * E.g. "CToken cZRX TotalBorrows"
      `, "TotalBorrows", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getTotalBorrows(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### TotalBorrowsCurrent

        * "CToken <CToken> TotalBorrowsCurrent" - Returns the cToken's total borrow balance with interest
          * E.g. "CToken cZRX TotalBorrowsCurrent"
      `, "TotalBorrowsCurrent", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getTotalBorrowsCurrent(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Reserves

        * "CToken <CToken> Reserves" - Returns the cToken's total reserves
          * E.g. "CToken cZRX Reserves"
      `, "Reserves", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getTotalReserves(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### ReserveFactor

        * "CToken <CToken> ReserveFactor" - Returns reserve factor of CToken contract
          * E.g. "CToken cZRX ReserveFactor" - Returns cZRX's reserve factor
      `, "ReserveFactor", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getReserveFactor(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Comptroller

        * "CToken <CToken> Comptroller" - Returns the cToken's comptroller
          * E.g. "CToken cZRX Comptroller"
      `, "Comptroller", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getComptroller(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### ExchangeRateStored

        * "CToken <CToken> ExchangeRateStored" - Returns the cToken's exchange rate (based on balances stored)
          * E.g. "CToken cZRX ExchangeRateStored"
      `, "ExchangeRateStored", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getExchangeRateStored(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### ExchangeRate

        * "CToken <CToken> ExchangeRate" - Returns the cToken's current exchange rate
          * E.g. "CToken cZRX ExchangeRate"
      `, "ExchangeRate", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getExchangeRate(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Cash

        * "CToken <CToken> Cash" - Returns the cToken's current cash
          * E.g. "CToken cZRX Cash"
      `, "Cash", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getCash(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### InterestRate

        * "CToken <CToken> InterestRate" - Returns the cToken's current interest rate
          * E.g. "CToken cZRX InterestRate"
      `, "InterestRate", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getInterestRate(world, cToken), { namePos: 1 }),
        new Command_1.Fetcher(`
        #### CallNum

        * "CToken <CToken> Call <signature>" - Simple direct call method, for now with no parameters
          * E.g. "CToken cZRX Call \"borrowIndex()\""
      `, "CallNum", [
            new Command_1.Arg("cToken", getCTokenV),
            new Command_1.Arg("signature", CoreValue_1.getStringV),
        ], async (world, { cToken, signature }) => {
            const res = await world.web3.eth.call({
                to: cToken._address,
                data: world.web3.eth.abi.encodeFunctionSignature(signature.val)
            });
            const resNum = world.web3.eth.abi.decodeParameter('uint256', res);
            return new Value_1.NumberV(resNum);
        }, { namePos: 1 }),
        new Command_1.Fetcher(`
        #### Implementation

        * "CToken <CToken> Implementation" - Returns the cToken's current implementation
          * E.g. "CToken cDAI Implementation"
      `, "Implementation", [
            new Command_1.Arg("cToken", getCTokenV)
        ], (world, { cToken }) => getImplementation(world, cToken), { namePos: 1 })
    ];
}
exports.cTokenFetchers = cTokenFetchers;
async function getCTokenValue(world, event) {
    return await Command_1.getFetcherValue("cToken", cTokenFetchers(), world, event);
}
exports.getCTokenValue = getCTokenValue;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ1Rva2VuVmFsdWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvVmFsdWUvQ1Rva2VuVmFsdWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBS0EsNENBS3NCO0FBQ3RCLHdDQUEyRDtBQUMzRCxvQ0FLa0I7QUFDbEIsc0RBQWdGO0FBRXpFLEtBQUssVUFBVSxVQUFVLENBQUMsS0FBWSxFQUFFLEtBQVk7SUFDekQsTUFBTSxPQUFPLEdBQUcsTUFBTSxvQkFBUSxDQUM1QixLQUFLLEVBQ0wsS0FBSyxFQUNMLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxJQUFJLGdCQUFRLENBQUMsaUNBQWdCLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQ25ELHdCQUFZLEVBQ1osZ0JBQVEsQ0FDVCxDQUFDO0lBRUYsT0FBTywwQ0FBeUIsQ0FBUyxLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFWRCxnQ0FVQztBQUVNLEtBQUssVUFBVSxtQkFBbUIsQ0FBQyxLQUFZLEVBQUUsS0FBWTtJQUNsRSxNQUFNLE9BQU8sR0FBRyxNQUFNLG9CQUFRLENBQzVCLEtBQUssRUFDTCxLQUFLLEVBQ0wsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksZ0JBQVEsQ0FBQyxpQ0FBZ0IsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFDbkQsd0JBQVksRUFDWixnQkFBUSxDQUNULENBQUM7SUFFRixPQUFPLDBDQUF5QixDQUFrQixLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3hFLENBQUM7QUFWRCxrREFVQztBQUVELEtBQUssVUFBVSxvQkFBb0IsQ0FBQyxLQUFZLEVBQUUsTUFBYztJQUM5RCxPQUFPLElBQUksZ0JBQVEsQ0FBQyxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZFLENBQUM7QUFF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b3JsZCB9IGZyb20gJy4uL1dvcmxkJztcbmltcG9ydCB7IENUb2tlbiB9IGZyb20gJy4uL0NvbnRyYWN0L0NUb2tlbic7XG5pbXBvcnQgeyBDRXJjMjBEZWxlZ2F0b3IgfSBmcm9tICcuLi9Db250cmFjdC9DRXJjMjBEZWxlZ2F0b3InO1xuaW1wb3J0IHsgRXJjMjAgfSBmcm9tICcuLi9Db250cmFjdC9FcmMyMCc7XG5pbXBvcnQge1xuICBnZXRBZGRyZXNzVixcbiAgZ2V0Q29yZVZhbHVlLFxuICBnZXRTdHJpbmdWLFxuICBtYXBWYWx1ZVxufSBmcm9tICcuLi9Db3JlVmFsdWUnO1xuaW1wb3J0IHsgQXJnLCBGZXRjaGVyLCBnZXRGZXRjaGVyVmFsdWUgfSBmcm9tICcuLi9Db21tYW5kJztcbmltcG9ydCB7XG4gIEFkZHJlc3NWLFxuICBOdW1iZXJWLFxuICBWYWx1ZSxcbiAgU3RyaW5nVlxufSBmcm9tICcuLi9WYWx1ZSc7XG5pbXBvcnQgeyBnZXRXb3JsZENvbnRyYWN0QnlBZGRyZXNzLCBnZXRDVG9rZW5BZGRyZXNzIH0gZnJvbSAnLi4vQ29udHJhY3RMb29rdXAnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q1Rva2VuVih3b3JsZDogV29ybGQsIGV2ZW50OiBFdmVudCk6IFByb21pc2U8Q1Rva2VuPiB7XG4gIGNvbnN0IGFkZHJlc3MgPSBhd2FpdCBtYXBWYWx1ZTxBZGRyZXNzVj4oXG4gICAgd29ybGQsXG4gICAgZXZlbnQsXG4gICAgKHN0cikgPT4gbmV3IEFkZHJlc3NWKGdldENUb2tlbkFkZHJlc3Mod29ybGQsIHN0cikpLFxuICAgIGdldENvcmVWYWx1ZSxcbiAgICBBZGRyZXNzVlxuICApO1xuXG4gIHJldHVybiBnZXRXb3JsZENvbnRyYWN0QnlBZGRyZXNzPENUb2tlbj4od29ybGQsIGFkZHJlc3MudmFsKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENFcmMyMERlbGVnYXRvclYod29ybGQ6IFdvcmxkLCBldmVudDogRXZlbnQpOiBQcm9taXNlPENFcmMyMERlbGVnYXRvcj4ge1xuICBjb25zdCBhZGRyZXNzID0gYXdhaXQgbWFwVmFsdWU8QWRkcmVzc1Y+KFxuICAgIHdvcmxkLFxuICAgIGV2ZW50LFxuICAgIChzdHIpID0+IG5ldyBBZGRyZXNzVihnZXRDVG9rZW5BZGRyZXNzKHdvcmxkLCBzdHIpKSxcbiAgICBnZXRDb3JlVmFsdWUsXG4gICAgQWRkcmVzc1ZcbiAgKTtcblxuICByZXR1cm4gZ2V0V29ybGRDb250cmFjdEJ5QWRkcmVzczxDRXJjMjBEZWxlZ2F0b3I+KHdvcmxkLCBhZGRyZXNzLnZhbCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEludGVyZXN0UmF0ZU1vZGVsKHdvcmxkOiBXb3JsZCwgY1Rva2VuOiBDVG9rZW4pOiBQcm9taXNlPEFkZHJlc3NWPiB7XG4gIHJldHVybiBuZXcgQWRkcmVzc1YoYXdhaXQgY1Rva2VuLm1ldGhvZHMuaW50ZXJlc3RSYXRlTW9kZWwoKS5jYWxsKCkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjVG9rZW5BZGRyZXNzKHdvcmxkOiBXb3JsZCwgY1Rva2VuOiBDVG9rZW4pOiBQcm9taXNlPEFkZHJlc3NWPiB7XG4gIHJldHVybiBuZXcgQWRkcmVzc1YoY1Rva2VuLl9hZGRyZXNzKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q1Rva2VuQWRtaW4od29ybGQ6IFdvcmxkLCBjVG9rZW46IENUb2tlbik6IFByb21pc2U8QWRkcmVzc1Y+IHtcbiAgcmV0dXJuIG5ldyBBZGRyZXNzVihhd2FpdCBjVG9rZW4ubWV0aG9kcy5hZG1pbigpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldENUb2tlblBlbmRpbmdBZG1pbih3b3JsZDogV29ybGQsIGNUb2tlbjogQ1Rva2VuKTogUHJvbWlzZTxBZGRyZXNzVj4ge1xuICByZXR1cm4gbmV3IEFkZHJlc3NWKGF3YWl0IGNUb2tlbi5tZXRob2RzLnBlbmRpbmdBZG1pbigpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGJhbGFuY2VPZlVuZGVybHlpbmcod29ybGQ6IFdvcmxkLCBjVG9rZW46IENUb2tlbiwgdXNlcjogc3RyaW5nKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBjVG9rZW4ubWV0aG9kcy5iYWxhbmNlT2ZVbmRlcmx5aW5nKHVzZXIpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEJvcnJvd0JhbGFuY2Uod29ybGQ6IFdvcmxkLCBjVG9rZW46IENUb2tlbiwgdXNlcik6IFByb21pc2U8TnVtYmVyVj4ge1xuICByZXR1cm4gbmV3IE51bWJlclYoYXdhaXQgY1Rva2VuLm1ldGhvZHMuYm9ycm93QmFsYW5jZUN1cnJlbnQodXNlcikuY2FsbCgpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Qm9ycm93QmFsYW5jZVN0b3JlZCh3b3JsZDogV29ybGQsIGNUb2tlbjogQ1Rva2VuLCB1c2VyKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBjVG9rZW4ubWV0aG9kcy5ib3Jyb3dCYWxhbmNlU3RvcmVkKHVzZXIpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFRvdGFsQm9ycm93cyh3b3JsZDogV29ybGQsIGNUb2tlbjogQ1Rva2VuKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBjVG9rZW4ubWV0aG9kcy50b3RhbEJvcnJvd3MoKS5jYWxsKCkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRUb3RhbEJvcnJvd3NDdXJyZW50KHdvcmxkOiBXb3JsZCwgY1Rva2VuOiBDVG9rZW4pOiBQcm9taXNlPE51bWJlclY+IHtcbiAgcmV0dXJuIG5ldyBOdW1iZXJWKGF3YWl0IGNUb2tlbi5tZXRob2RzLnRvdGFsQm9ycm93c0N1cnJlbnQoKS5jYWxsKCkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRSZXNlcnZlRmFjdG9yKHdvcmxkOiBXb3JsZCwgY1Rva2VuOiBDVG9rZW4pOiBQcm9taXNlPE51bWJlclY+IHtcbiAgcmV0dXJuIG5ldyBOdW1iZXJWKGF3YWl0IGNUb2tlbi5tZXRob2RzLnJlc2VydmVGYWN0b3JNYW50aXNzYSgpLmNhbGwoKSwgMS4wZTE4KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0VG90YWxSZXNlcnZlcyh3b3JsZDogV29ybGQsIGNUb2tlbjogQ1Rva2VuKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBjVG9rZW4ubWV0aG9kcy50b3RhbFJlc2VydmVzKCkuY2FsbCgpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q29tcHRyb2xsZXIod29ybGQ6IFdvcmxkLCBjVG9rZW46IENUb2tlbik6IFByb21pc2U8QWRkcmVzc1Y+IHtcbiAgcmV0dXJuIG5ldyBBZGRyZXNzVihhd2FpdCBjVG9rZW4ubWV0aG9kcy5jb21wdHJvbGxlcigpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEV4Y2hhbmdlUmF0ZVN0b3JlZCh3b3JsZDogV29ybGQsIGNUb2tlbjogQ1Rva2VuKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBjVG9rZW4ubWV0aG9kcy5leGNoYW5nZVJhdGVTdG9yZWQoKS5jYWxsKCkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRFeGNoYW5nZVJhdGUod29ybGQ6IFdvcmxkLCBjVG9rZW46IENUb2tlbik6IFByb21pc2U8TnVtYmVyVj4ge1xuICByZXR1cm4gbmV3IE51bWJlclYoYXdhaXQgY1Rva2VuLm1ldGhvZHMuZXhjaGFuZ2VSYXRlQ3VycmVudCgpLmNhbGwoKSwgMWUxOCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldENhc2god29ybGQ6IFdvcmxkLCBjVG9rZW46IENUb2tlbik6IFByb21pc2U8TnVtYmVyVj4ge1xuICByZXR1cm4gbmV3IE51bWJlclYoYXdhaXQgY1Rva2VuLm1ldGhvZHMuZ2V0Q2FzaCgpLmNhbGwoKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEludGVyZXN0UmF0ZSh3b3JsZDogV29ybGQsIGNUb2tlbjogQ1Rva2VuKTogUHJvbWlzZTxOdW1iZXJWPiB7XG4gIHJldHVybiBuZXcgTnVtYmVyVihhd2FpdCBjVG9rZW4ubWV0aG9kcy5ib3Jyb3dSYXRlUGVyQmxvY2soKS5jYWxsKCksIDEuMGUxOCAvIDIxMDI0MDApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRJbXBsZW1lbnRhdGlvbih3b3JsZDogV29ybGQsIGNUb2tlbjogQ1Rva2VuKTogUHJvbWlzZTxBZGRyZXNzVj4ge1xuICByZXR1cm4gbmV3IEFkZHJlc3NWKGF3YWl0IChjVG9rZW4gYXMgQ0VyYzIwRGVsZWdhdG9yKS5tZXRob2RzLmltcGxlbWVudGF0aW9uKCkuY2FsbCgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNUb2tlbkZldGNoZXJzKCkge1xuICByZXR1cm4gW1xuICAgIG5ldyBGZXRjaGVyPHsgY1Rva2VuOiBDVG9rZW4gfSwgQWRkcmVzc1Y+KGBcbiAgICAgICAgIyMjIyBBZGRyZXNzXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBBZGRyZXNzXCIgLSBSZXR1cm5zIGFkZHJlc3Mgb2YgQ1Rva2VuIGNvbnRyYWN0XG4gICAgICAgICAgKiBFLmcuIFwiQ1Rva2VuIGNaUlggQWRkcmVzc1wiIC0gUmV0dXJucyBjWlJYJ3MgYWRkcmVzc1xuICAgICAgYCxcbiAgICAgIFwiQWRkcmVzc1wiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7IGNUb2tlbiB9KSA9PiBjVG9rZW5BZGRyZXNzKHdvcmxkLCBjVG9rZW4pLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuXG4gICAgbmV3IEZldGNoZXI8eyBjVG9rZW46IENUb2tlbiB9LCBBZGRyZXNzVj4oYFxuICAgICAgICAjIyMjIEludGVyZXN0UmF0ZU1vZGVsXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBJbnRlcmVzdFJhdGVNb2RlbFwiIC0gUmV0dXJucyB0aGUgaW50ZXJlc3QgcmF0ZSBtb2RlbCBvZiBDVG9rZW4gY29udHJhY3RcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBJbnRlcmVzdFJhdGVNb2RlbFwiIC0gUmV0dXJucyBjWlJYJ3MgaW50ZXJlc3QgcmF0ZSBtb2RlbFxuICAgICAgYCxcbiAgICAgIFwiSW50ZXJlc3RSYXRlTW9kZWxcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImNUb2tlblwiLCBnZXRDVG9rZW5WKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgeyBjVG9rZW4gfSkgPT4gZ2V0SW50ZXJlc3RSYXRlTW9kZWwod29ybGQsIGNUb2tlbiksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG5cbiAgICBuZXcgRmV0Y2hlcjx7IGNUb2tlbjogQ1Rva2VuIH0sIEFkZHJlc3NWPihgXG4gICAgICAgICMjIyMgQWRtaW5cblxuICAgICAgICAqIFwiQ1Rva2VuIDxDVG9rZW4+IEFkbWluXCIgLSBSZXR1cm5zIHRoZSBhZG1pbiBvZiBDVG9rZW4gY29udHJhY3RcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBBZG1pblwiIC0gUmV0dXJucyBjWlJYJ3MgYWRtaW5cbiAgICAgIGAsXG4gICAgICBcIkFkbWluXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJjVG9rZW5cIiwgZ2V0Q1Rva2VuVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIHsgY1Rva2VuIH0pID0+IGdldENUb2tlbkFkbWluKHdvcmxkLCBjVG9rZW4pLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuXG4gICAgbmV3IEZldGNoZXI8eyBjVG9rZW46IENUb2tlbiB9LCBBZGRyZXNzVj4oYFxuICAgICAgICAjIyMjIFBlbmRpbmdBZG1pblxuXG4gICAgICAgICogXCJDVG9rZW4gPENUb2tlbj4gUGVuZGluZ0FkbWluXCIgLSBSZXR1cm5zIHRoZSBwZW5kaW5nIGFkbWluIG9mIENUb2tlbiBjb250cmFjdFxuICAgICAgICAgICogRS5nLiBcIkNUb2tlbiBjWlJYIFBlbmRpbmdBZG1pblwiIC0gUmV0dXJucyBjWlJYJ3MgcGVuZGluZyBhZG1pblxuICAgICAgYCxcbiAgICAgIFwiUGVuZGluZ0FkbWluXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJjVG9rZW5cIiwgZ2V0Q1Rva2VuVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIHsgY1Rva2VuIH0pID0+IGdldENUb2tlblBlbmRpbmdBZG1pbih3b3JsZCwgY1Rva2VuKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcblxuICAgIG5ldyBGZXRjaGVyPHsgY1Rva2VuOiBDVG9rZW4gfSwgQWRkcmVzc1Y+KGBcbiAgICAgICAgIyMjIyBVbmRlcmx5aW5nXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBVbmRlcmx5aW5nXCIgLSBSZXR1cm5zIHRoZSB1bmRlcmx5aW5nIGFzc2V0IChpZiBhcHBsaWNhYmxlKVxuICAgICAgICAgICogRS5nLiBcIkNUb2tlbiBjWlJYIFVuZGVybHlpbmdcIlxuICAgICAgYCxcbiAgICAgIFwiVW5kZXJseWluZ1wiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpXG4gICAgICBdLFxuICAgICAgYXN5bmMgKHdvcmxkLCB7IGNUb2tlbiB9KSA9PiBuZXcgQWRkcmVzc1YoYXdhaXQgY1Rva2VuLm1ldGhvZHMudW5kZXJseWluZygpLmNhbGwoKSksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG5cbiAgICBuZXcgRmV0Y2hlcjx7IGNUb2tlbjogQ1Rva2VuLCBhZGRyZXNzOiBBZGRyZXNzViB9LCBOdW1iZXJWPihgXG4gICAgICAgICMjIyMgVW5kZXJseWluZ0JhbGFuY2VcblxuICAgICAgICAqIFwiQ1Rva2VuIDxDVG9rZW4+IFVuZGVybHlpbmdCYWxhbmNlIDxVc2VyPlwiIC0gUmV0dXJucyBhIHVzZXIncyB1bmRlcmx5aW5nIGJhbGFuY2UgKGJhc2VkIG9uIGdpdmVuIGV4Y2hhbmdlIHJhdGUpXG4gICAgICAgICAgKiBFLmcuIFwiQ1Rva2VuIGNaUlggVW5kZXJseWluZ0JhbGFuY2UgR2VvZmZcIlxuICAgICAgYCxcbiAgICAgIFwiVW5kZXJseWluZ0JhbGFuY2VcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImNUb2tlblwiLCBnZXRDVG9rZW5WKSxcbiAgICAgICAgbmV3IEFyZzxBZGRyZXNzVj4oXCJhZGRyZXNzXCIsIGdldEFkZHJlc3NWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgeyBjVG9rZW4sIGFkZHJlc3MgfSkgPT4gYmFsYW5jZU9mVW5kZXJseWluZyh3b3JsZCwgY1Rva2VuLCBhZGRyZXNzLnZhbCksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG5cbiAgICBuZXcgRmV0Y2hlcjx7IGNUb2tlbjogQ1Rva2VuLCBhZGRyZXNzOiBBZGRyZXNzViB9LCBOdW1iZXJWPihgXG4gICAgICAgICMjIyMgQm9ycm93QmFsYW5jZVxuXG4gICAgICAgICogXCJDVG9rZW4gPENUb2tlbj4gQm9ycm93QmFsYW5jZSA8VXNlcj5cIiAtIFJldHVybnMgYSB1c2VyJ3MgYm9ycm93IGJhbGFuY2UgKGluY2x1ZGluZyBpbnRlcmVzdClcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBCb3Jyb3dCYWxhbmNlIEdlb2ZmXCJcbiAgICAgIGAsXG4gICAgICBcIkJvcnJvd0JhbGFuY2VcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImNUb2tlblwiLCBnZXRDVG9rZW5WKSxcbiAgICAgICAgbmV3IEFyZyhcImFkZHJlc3NcIiwgZ2V0QWRkcmVzc1YpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7IGNUb2tlbiwgYWRkcmVzcyB9KSA9PiBnZXRCb3Jyb3dCYWxhbmNlKHdvcmxkLCBjVG9rZW4sIGFkZHJlc3MudmFsKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcblxuICAgIG5ldyBGZXRjaGVyPHsgY1Rva2VuOiBDVG9rZW4sIGFkZHJlc3M6IEFkZHJlc3NWIH0sIE51bWJlclY+KGBcbiAgICAgICAgIyMjIyBCb3Jyb3dCYWxhbmNlU3RvcmVkXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBCb3Jyb3dCYWxhbmNlU3RvcmVkIDxVc2VyPlwiIC0gUmV0dXJucyBhIHVzZXIncyBib3Jyb3cgYmFsYW5jZSAod2l0aG91dCBzcGVjaWZpY2FsbHkgcmUtYWNjcnVpbmcgaW50ZXJlc3QpXG4gICAgICAgICAgKiBFLmcuIFwiQ1Rva2VuIGNaUlggQm9ycm93QmFsYW5jZVN0b3JlZCBHZW9mZlwiXG4gICAgICBgLFxuICAgICAgXCJCb3Jyb3dCYWxhbmNlU3RvcmVkXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJjVG9rZW5cIiwgZ2V0Q1Rva2VuViksXG4gICAgICAgIG5ldyBBcmcoXCJhZGRyZXNzXCIsIGdldEFkZHJlc3NWKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgeyBjVG9rZW4sIGFkZHJlc3MgfSkgPT4gZ2V0Qm9ycm93QmFsYW5jZVN0b3JlZCh3b3JsZCwgY1Rva2VuLCBhZGRyZXNzLnZhbCksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG5cbiAgICBuZXcgRmV0Y2hlcjx7IGNUb2tlbjogQ1Rva2VuIH0sIE51bWJlclY+KGBcbiAgICAgICAgIyMjIyBUb3RhbEJvcnJvd3NcblxuICAgICAgICAqIFwiQ1Rva2VuIDxDVG9rZW4+IFRvdGFsQm9ycm93c1wiIC0gUmV0dXJucyB0aGUgY1Rva2VuJ3MgdG90YWwgYm9ycm93IGJhbGFuY2VcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBUb3RhbEJvcnJvd3NcIlxuICAgICAgYCxcbiAgICAgIFwiVG90YWxCb3Jyb3dzXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJjVG9rZW5cIiwgZ2V0Q1Rva2VuVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIHsgY1Rva2VuIH0pID0+IGdldFRvdGFsQm9ycm93cyh3b3JsZCwgY1Rva2VuKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcblxuICAgIG5ldyBGZXRjaGVyPHsgY1Rva2VuOiBDVG9rZW4gfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIFRvdGFsQm9ycm93c0N1cnJlbnRcblxuICAgICAgICAqIFwiQ1Rva2VuIDxDVG9rZW4+IFRvdGFsQm9ycm93c0N1cnJlbnRcIiAtIFJldHVybnMgdGhlIGNUb2tlbidzIHRvdGFsIGJvcnJvdyBiYWxhbmNlIHdpdGggaW50ZXJlc3RcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBUb3RhbEJvcnJvd3NDdXJyZW50XCJcbiAgICAgIGAsXG4gICAgICBcIlRvdGFsQm9ycm93c0N1cnJlbnRcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImNUb2tlblwiLCBnZXRDVG9rZW5WKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgeyBjVG9rZW4gfSkgPT4gZ2V0VG90YWxCb3Jyb3dzQ3VycmVudCh3b3JsZCwgY1Rva2VuKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcblxuICAgIG5ldyBGZXRjaGVyPHsgY1Rva2VuOiBDVG9rZW4gfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIFJlc2VydmVzXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBSZXNlcnZlc1wiIC0gUmV0dXJucyB0aGUgY1Rva2VuJ3MgdG90YWwgcmVzZXJ2ZXNcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBSZXNlcnZlc1wiXG4gICAgICBgLFxuICAgICAgXCJSZXNlcnZlc1wiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7IGNUb2tlbiB9KSA9PiBnZXRUb3RhbFJlc2VydmVzKHdvcmxkLCBjVG9rZW4pLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuXG4gICAgbmV3IEZldGNoZXI8eyBjVG9rZW46IENUb2tlbiB9LCBOdW1iZXJWPihgXG4gICAgICAgICMjIyMgUmVzZXJ2ZUZhY3RvclxuXG4gICAgICAgICogXCJDVG9rZW4gPENUb2tlbj4gUmVzZXJ2ZUZhY3RvclwiIC0gUmV0dXJucyByZXNlcnZlIGZhY3RvciBvZiBDVG9rZW4gY29udHJhY3RcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBSZXNlcnZlRmFjdG9yXCIgLSBSZXR1cm5zIGNaUlgncyByZXNlcnZlIGZhY3RvclxuICAgICAgYCxcbiAgICAgIFwiUmVzZXJ2ZUZhY3RvclwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7IGNUb2tlbiB9KSA9PiBnZXRSZXNlcnZlRmFjdG9yKHdvcmxkLCBjVG9rZW4pLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuXG4gICAgbmV3IEZldGNoZXI8eyBjVG9rZW46IENUb2tlbiB9LCBBZGRyZXNzVj4oYFxuICAgICAgICAjIyMjIENvbXB0cm9sbGVyXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBDb21wdHJvbGxlclwiIC0gUmV0dXJucyB0aGUgY1Rva2VuJ3MgY29tcHRyb2xsZXJcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBDb21wdHJvbGxlclwiXG4gICAgICBgLFxuICAgICAgXCJDb21wdHJvbGxlclwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7IGNUb2tlbiB9KSA9PiBnZXRDb21wdHJvbGxlcih3b3JsZCwgY1Rva2VuKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcblxuICAgIG5ldyBGZXRjaGVyPHsgY1Rva2VuOiBDVG9rZW4gfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIEV4Y2hhbmdlUmF0ZVN0b3JlZFxuXG4gICAgICAgICogXCJDVG9rZW4gPENUb2tlbj4gRXhjaGFuZ2VSYXRlU3RvcmVkXCIgLSBSZXR1cm5zIHRoZSBjVG9rZW4ncyBleGNoYW5nZSByYXRlIChiYXNlZCBvbiBiYWxhbmNlcyBzdG9yZWQpXG4gICAgICAgICAgKiBFLmcuIFwiQ1Rva2VuIGNaUlggRXhjaGFuZ2VSYXRlU3RvcmVkXCJcbiAgICAgIGAsXG4gICAgICBcIkV4Y2hhbmdlUmF0ZVN0b3JlZFwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7IGNUb2tlbiB9KSA9PiBnZXRFeGNoYW5nZVJhdGVTdG9yZWQod29ybGQsIGNUb2tlbiksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG5cbiAgICBuZXcgRmV0Y2hlcjx7IGNUb2tlbjogQ1Rva2VuIH0sIE51bWJlclY+KGBcbiAgICAgICAgIyMjIyBFeGNoYW5nZVJhdGVcblxuICAgICAgICAqIFwiQ1Rva2VuIDxDVG9rZW4+IEV4Y2hhbmdlUmF0ZVwiIC0gUmV0dXJucyB0aGUgY1Rva2VuJ3MgY3VycmVudCBleGNoYW5nZSByYXRlXG4gICAgICAgICAgKiBFLmcuIFwiQ1Rva2VuIGNaUlggRXhjaGFuZ2VSYXRlXCJcbiAgICAgIGAsXG4gICAgICBcIkV4Y2hhbmdlUmF0ZVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCB7IGNUb2tlbiB9KSA9PiBnZXRFeGNoYW5nZVJhdGUod29ybGQsIGNUb2tlbiksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG5cbiAgICBuZXcgRmV0Y2hlcjx7IGNUb2tlbjogQ1Rva2VuIH0sIE51bWJlclY+KGBcbiAgICAgICAgIyMjIyBDYXNoXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBDYXNoXCIgLSBSZXR1cm5zIHRoZSBjVG9rZW4ncyBjdXJyZW50IGNhc2hcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBDYXNoXCJcbiAgICAgIGAsXG4gICAgICBcIkNhc2hcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImNUb2tlblwiLCBnZXRDVG9rZW5WKVxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgeyBjVG9rZW4gfSkgPT4gZ2V0Q2FzaCh3b3JsZCwgY1Rva2VuKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcblxuICAgIG5ldyBGZXRjaGVyPHsgY1Rva2VuOiBDVG9rZW4gfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIEludGVyZXN0UmF0ZVxuXG4gICAgICAgICogXCJDVG9rZW4gPENUb2tlbj4gSW50ZXJlc3RSYXRlXCIgLSBSZXR1cm5zIHRoZSBjVG9rZW4ncyBjdXJyZW50IGludGVyZXN0IHJhdGVcbiAgICAgICAgICAqIEUuZy4gXCJDVG9rZW4gY1pSWCBJbnRlcmVzdFJhdGVcIlxuICAgICAgYCxcbiAgICAgIFwiSW50ZXJlc3RSYXRlXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJjVG9rZW5cIiwgZ2V0Q1Rva2VuVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIHtjVG9rZW59KSA9PiBnZXRJbnRlcmVzdFJhdGUod29ybGQsIGNUb2tlbiksXG4gICAgICB7bmFtZVBvczogMX1cbiAgICApLFxuICAgIG5ldyBGZXRjaGVyPHtjVG9rZW46IENUb2tlbiwgc2lnbmF0dXJlOiBTdHJpbmdWfSwgTnVtYmVyVj4oYFxuICAgICAgICAjIyMjIENhbGxOdW1cblxuICAgICAgICAqIFwiQ1Rva2VuIDxDVG9rZW4+IENhbGwgPHNpZ25hdHVyZT5cIiAtIFNpbXBsZSBkaXJlY3QgY2FsbCBtZXRob2QsIGZvciBub3cgd2l0aCBubyBwYXJhbWV0ZXJzXG4gICAgICAgICAgKiBFLmcuIFwiQ1Rva2VuIGNaUlggQ2FsbCBcXFwiYm9ycm93SW5kZXgoKVxcXCJcIlxuICAgICAgYCxcbiAgICAgIFwiQ2FsbE51bVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiY1Rva2VuXCIsIGdldENUb2tlblYpLFxuICAgICAgICBuZXcgQXJnKFwic2lnbmF0dXJlXCIsIGdldFN0cmluZ1YpLFxuICAgICAgXSxcbiAgICAgIGFzeW5jICh3b3JsZCwge2NUb2tlbiwgc2lnbmF0dXJlfSkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB3b3JsZC53ZWIzLmV0aC5jYWxsKHtcbiAgICAgICAgICAgIHRvOiBjVG9rZW4uX2FkZHJlc3MsXG4gICAgICAgICAgICBkYXRhOiB3b3JsZC53ZWIzLmV0aC5hYmkuZW5jb2RlRnVuY3Rpb25TaWduYXR1cmUoc2lnbmF0dXJlLnZhbClcbiAgICAgICAgICB9KVxuICAgICAgICBjb25zdCByZXNOdW0gOiBhbnkgPSB3b3JsZC53ZWIzLmV0aC5hYmkuZGVjb2RlUGFyYW1ldGVyKCd1aW50MjU2JyxyZXMpO1xuICAgICAgICByZXR1cm4gbmV3IE51bWJlclYocmVzTnVtKTtcbiAgICAgIH1cbiAgICAgICxcbiAgICAgIHtuYW1lUG9zOiAxfVxuICAgICksXG4gICAgbmV3IEZldGNoZXI8eyBjVG9rZW46IENUb2tlbiB9LCBBZGRyZXNzVj4oYFxuICAgICAgICAjIyMjIEltcGxlbWVudGF0aW9uXG5cbiAgICAgICAgKiBcIkNUb2tlbiA8Q1Rva2VuPiBJbXBsZW1lbnRhdGlvblwiIC0gUmV0dXJucyB0aGUgY1Rva2VuJ3MgY3VycmVudCBpbXBsZW1lbnRhdGlvblxuICAgICAgICAgICogRS5nLiBcIkNUb2tlbiBjREFJIEltcGxlbWVudGF0aW9uXCJcbiAgICAgIGAsXG4gICAgICBcIkltcGxlbWVudGF0aW9uXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJjVG9rZW5cIiwgZ2V0Q1Rva2VuVilcbiAgICAgIF0sXG4gICAgICAod29ybGQsIHsgY1Rva2VuIH0pID0+IGdldEltcGxlbWVudGF0aW9uKHdvcmxkLCBjVG9rZW4pLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApXG4gIF07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDVG9rZW5WYWx1ZSh3b3JsZDogV29ybGQsIGV2ZW50OiBFdmVudCk6IFByb21pc2U8VmFsdWU+IHtcbiAgcmV0dXJuIGF3YWl0IGdldEZldGNoZXJWYWx1ZTxhbnksIGFueT4oXCJjVG9rZW5cIiwgY1Rva2VuRmV0Y2hlcnMoKSwgd29ybGQsIGV2ZW50KTtcbn1cbiJdfQ==